\documentclass[11pt]{report}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{geometry}
\geometry{tmargin=3cm,bmargin=3cm,lmargin=3cm,rmargin=3cm}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{natbib}
%\usepackage{doi}
\usepackage{scrextend}
\usepackage{graphicx}
\usepackage{placeins}
\usepackage{booktabs}
%\usepackage{tabularx} %problems with knitr
\usepackage{ltablex}
\usepackage[table]{xcolor}
\usepackage{soul}
\usepackage[
  unicode=true,
  pdfusetitle,
  bookmarks=true,
  bookmarksnumbered=true,
  bookmarksopen=true,
  bookmarksopenlevel=2,
  breaklinks=true,
  colorlinks=true
]{hyperref}
\hypersetup{
 pdfstartview={XYZ null null 1},
 citecolor={blue}
}

\graphicspath{ {Figures/} }
\newcommand{\dna}{\texttt{DNA}}
\newcommand{\rdna}{\texttt{rDNA}}
\newcommand{\rstudio}{\texttt{RStudio}}
\newcommand{\java}{\texttt{Java}}
\newcommand{\R}{\texttt{R}}
\newcommand{\github}{\href{https://github.com/leifeld/dna}{\texttt{GitHub}}}
\newcommand*{\fullref}[1]{\hyperref[{#1}]{ \nameref*{#1}}} % One single link
\newcommand{\code}[1]{% same color and decoration as knitr bash command
  \textcolor{codecolort}{%
    \sethlcolor{codecolorbg}\hl{%
      \texttt{#1}%
    }%
  }%
}

\definecolor{codecolorbg}{rgb}{0.969, 0.969, 0.969}
\definecolor{codecolort}{rgb}{0.345, 0.345, 0.345}
\definecolor{black}{RGB}{0,0,0}
\definecolor{grey}{RGB}{240,240,240}
\definecolor{white}{RGB}{255,255,255}

\usepackage{suffix}

\newcommand\chapterauthor[1]{\authortoc{#1}\printchapterauthor{#1}}
\WithSuffix\newcommand\chapterauthor*[1]{\printchapterauthor{#1}}

\makeatletter
\newcommand{\printchapterauthor}[1]{%
  {\parindent0pt\vspace*{-25pt}%
  \linespread{1.1}\large\scshape#1%
  \par\nobreak\vspace*{35pt}}
  \@afterheading%
}
\newcommand{\authortoc}[1]{%
  \addtocontents{toc}{\vskip-10pt}%
  \addtocontents{toc}{%
    \protect\contentsline{chapter}%
    {\hskip1.3em\mdseries\scshape\protect\scriptsize#1}{}{}}
  \addtocontents{toc}{\vskip5pt}%
}
\makeatother


\newcommand{\Autorname}{\addtocontents{toc}{\hspace{0.47cm}\emph{\aut}\par}}

\setlength{\parindent}{0em}
\setlength{\parskip}{0.5em}

\bibpunct[: ]{(}{)}{;}{a}{}{,}


\pagenumbering{roman} % roman numbering in frontmatter
\begin{document}
<<setup, include=FALSE, cache=FALSE, results='hide', message=FALSE, warning=FALSE>>=
library("knitr")
# set global chunk options
opts_chunk$set(fig.path = 'figure/workshop-', fig.align = 'center', fig.show = 'hold')
options(formatR.arrow = TRUE, width = 90)
knit_hooks$set(crop=hook_pdfcrop)
@

\title{Discourse Network Analyzer Manual}
\date{\footnotesize{Last update: DNA 2.0 beta 20 with rDNA 2.0.4 on \today.}}
\author{Philip Leifeld, Johannes Gruber and Felix Rolf Bossner}

\maketitle
% change linkcolor in TOC
{\hypersetup{linkcolor=black}
\tableofcontents
}


\chapter{Introduction} \label{sec:intro}
\FloatBarrier
\pagenumbering{arabic}

This manual demonstrates how to install, set up and use the open-source standalone software \texttt{Discourse Network Analyzer} (\dna) and its companion \R\ package \rdna\ \citep{leifeld2018rdna}, which are designed for researchers using the method \textit{discourse network analysis}.\footnote{\textit{This manual is a work in progress and will be continuously updated during the year 2018. See \href{https://github.com/leifeld/dna/blob/master/manual/dna-manual.pdf}{\texttt{github.com/leifeld/dna/blob/master/manual/}} for the most recent version}.
}
By combining content and dynamic network analysis, this method can reveal the structure and dynamics of debates, such as political discourses.
For the user, the method comprises three basic steps: first, to annotate statements of actors in unstructured (text) sources; second, to create networks from the thereby structured data; and finally to analyse and interpret the results by employing the toolbox of network analysis. The results can take a number of different forms, such as congruence or conflict networks at the actor or concept level, affiliation networks of actors and concept stances, and longitudinal versions of these networks (see Section~\ref{sec:algorithms} or \citet{Leifeld.2016oxf} for a comprehensive overview of the method).

The benefit of using the \java\ software \dna\ is that it is specifically designed to aid the user in the first two of these basic steps of discourse network analysis. It is mainly designed for qualitative content analysis, which in this case means, to annotate the statements, or in other words, to structure the textual data. The program is also able, to create different kinds of network matrices and export them to other programs for further analysis and plotting. \dna\ is furthermore designed to help the user to develop a comprehensive workflow, from importing raw text, over managing multiple users as well as different types of documents, supporting the coding process with a regular expression highlighter to basic analysis options during export. Additionally, while the software is primarily designed for discourse network analysis, it is also very flexible as the statement types can be adjusted (\textit{see Section~\ref{subsec:stattype}}) to accommodate different content analysis tasks, such as, for example, framing analysis. While there are numerous alternative software packages for qualitative content analysis, there are very few which were specifically developed with discourse network analysis in mind and therefore lack the functionality necessary for exporting network data.

The companion \R\ package to \dna---\rdna---additionally helps with the remaining basic step mentioned above: analysis of the coded statements. \rdna\ integrates the results from coding performed in \dna\ with the statistical computing environment \R\ to perform more in-depth analysis of the coded material. While data can be exported to other software such as %
\textsc{Ucinet}, % 
{\protect\raisebox{.5ex}{\color[rgb]{0.1,0.1,0.1}v}% dark gray
  \protect\raisebox{.1ex}{\color[rgb]{0.3,0.3,0.3}i}% light gray
  \protect\raisebox{-.1ex}{\color[rgb]{0.1,0.1,0.1}s}% dark gray
  \protect\raisebox{.1ex}{\color[rgb]{0.3,0.3,0.3}o}% light gray
  \protect\raisebox{-.1ex}{\color[rgb]{0.1,0.1,0.1}n}% dark gray
  \protect\raisebox{-.4ex}{\color[rgb]{0.3,0.3,0.3}e}% light gray
}, \textsc{NetMiner}, \textsc{Gephi} %
and more, \R\ is the preferred choice, as it enables reproducible research, is free and open source and has a huge community of users and developers who are engaged in all kinds of data analysis tasks. Consequently, \R\ has several fantastic packages developed specifically for network analysis---such as \texttt{statnet} \citep{statnet}, \texttt{igraph} \citep{igraph}, \texttt{xergm} \citep{leifeld2017temporal, leifeld2017xergm:}, \texttt{sna} \citep{sna}, \texttt{network} \citep{network}, \texttt{tidygraph} \citep{tidygraph} and \texttt{ggraph} \citep{ggraph}---and a lot more that can aid content and network analysis even though they were written with other tasks in mind. Most of these packages work seamlessly with data processed by \rdna\ and therefore add a myriad of possibilities to the native functions of our own \R\ package.

In recent years, discourse network analysis has been employed by a growing number of scholars in a wide field of policy sectors, such as 
pension politics \citep{Leifeld.2013, Leifeld.2016pen}, 
climate politics \citep{fisher2013mapping, fisher2013where, Broadbent.2014, Gkiouzepas.2015, Manfredo.2014, Schneider.2014, Stoddart.2015, Wagner.2017, Yun.2014}, 
software patents and property rights \citep{Leifeld.2012, Herweg.2013}, 
Internet policy \citep{Breindl.2013}, 
infrastructure projects \citep{Nagel.2016}, 
energy policy \citep{Brutschin.2013, Haunss.2017, Imbert.2017, Rinscheid.2015, Rinscheidetal.2015},
%\textbf{(Mayer, 2015)}, 
shooting rampages \citep{Hurka.2013}, 
abortion \citep{Muller.2014, Muller.2014b, Muller.2015}, 
outdoor sports \citep{Stoddartetal.2015}, 
water politics \citep{Brandenberger.2015, Cisneros.2015}, 
deforestation \citep{Rantala.2014}, 
genetically modified organisms \citep{Tosun.2015}, 
higher education \citep{Naegler.2015}, 
international financial politics \citep{Werner.2015}, 
and online deception \citep{Wu.2015}. Many of these studies were already employing \dna\ and as the academic interest in discourse network analysis has steadily grown in recent years, the use of both, the method and the software, will eventually become more widespread.

%To Do:
%Future Research
% And while the method is spreading, it is also constantly advanced and extended. Some of the most promising approaches include:
%  Loyalty of actors to concepts
%  Modularity of debates over time.
%  Dynamic, signed, bipartite community detection.
%  Self-contradictions.
%  Dynamic visualization.
%  Better visualization methods.
%  Centrality of actors or concepts in discourse networks.
%  Intercoder reliability for nested coding.
%  Semi-automatic coding of statements (via NLP or machine learning).
%  Experimental approaches.
%  Ideological scaling across data sources.
%  Co-evolutionary model for multiple debates or edge types.
%  Prediction methods.
%  Better goodness-of-fit measures for REMs.
%  Other types of decay/memory.
%  Endogenous estimation of decay parameter(s).
%  Causal inference for REMs: e. g., do actors influence other actors of the same type to adopt their concepts (=contagion), or does the same actor type independently lead to similar preferences?

The outline of this manual is as follows. Section~\ref{sec:algorithms} is a concise and fairly technical description of the types of networks \dna\ can export.
Section~\ref{sec:installation} explains how to install \dna\ and \rdna\ which both rely on a correctly set up \java\ runtime environment. While installing the programs themselves would probably not be worth its own section, installing \java\ on some operating systems can be surprisingly tough---at least without our explanations.
Then four sections follow, which describe the usage of \dna\ in detail: Section~\ref{sec:dna-prep} describes how to set up a project in \dna, including the creation of a database, adding and managing users and how to set up or edit statement types and variables.
Section~\ref{sec:dna-import} explains how you can import and organise your raw data (i.\,e.\, documents).
Section~\ref{sec:dna-coding} provides and overview of how you code statements in \dna. Even though this process is very straightforward the section also reveals some functions implemented in \dna\ which can help you to code material faster and more reliable.
Section~\ref{sec:dna-export} will explain---once it is completed---how data can be exported to other programs for further analysis.
Section~\ref{sec:rdna} is an introductory tutorial on using the \rdna\ package to perform additional analysis and plotting tasks using the infrastructure provided by \R.

Both \dna\ and \rdna\ can be downloaded from \github (\textit{See Section~\ref{sec:installation}}).
Questions and bug reports can be posted in the issue tracker on \github.





\chapter{\dna\ algorithms} \label{sec:algorithms}
\chapterauthor{Philip Leifeld}
\FloatBarrier
This section summarizes the main algorithms implemented in \dna\ in a technical way.

$X$ is a three-dimensional array representing statement counts. $x_{ijk}$ is a specific count value in this array, with the first index $i$ denoting an instance of the first variable (e.\,g.\,, organization $i$), the second index $j$ denoting an instance of the second variable (e.\,g.\,, concept $j$), and the third index $k$ denoting a level on the qualifier variable (e.\,g.\,, agreement = $1$). For example, $x_{ijk} = 5$ could mean that organization $i$ mentions concept $j$ with intensity $k$ five times.

Where the qualifier variable is binary, \emph{false} values are represented as $0$ and \emph{true} values as $1$ on the $k$ index, i.\,e.\,, $K^\text{binary} = \{ 0; 1 \}$. Where the qualifier variable is integer, the respective integer value is used as the level. This implies that $k$ can take positive or negative values or 0, i.e, $K^\text{integer} \subseteq \mathbb{Z}$. Note that all $k$ levels of the scale are included in $K$, not just those values that are empirically observed.

Indices with a prime denote a second instance of an element, e.\,g.\,, $i'$ may denote another organization. $Y$ denotes the output matrix to be obtained by applying a transformation to $X$. The following transformations are possible:

\section{Congruence}
In a congruence network, the edge weight between nodes $i$ and $i'$ represents the number of times they co-support or co-reject second-variable nodes (if a binary qualifier is used) or the cumulative similarity between $i$ and $i'$ over their assessments of second-variable nodes (in the case of an integer qualifier variable).

In the integer case:
\begin{equation}
 y_{ii'}^\text{congruence} = \Phi_{ii'}\left( \sum_{j = 1}^n \sum_{k} \sum_{k'} x_{ijk} x_{i'jk'} \left( 1 - \frac{\vert k - k' \vert}{\vert K \vert - 1} \right) \right)
\end{equation}
where $\Phi_{ii'}(\cdot)$ denotes a normalization function (to be specified below).

In the binary case, i.\,e.\,, $\vert K \vert = 2$, this reduces to
\begin{equation}
 y_{ii'}^\text{congruence binary} = \Phi_{ii'}\left( \sum_{j = 1}^n \sum_{k} x_{ijk} x_{i'jk} + (1 - x_{ijk}) (1 - x_{i'jk}) \right).
\end{equation}

\section{Conflict}
Binary case:
\begin{equation}
 y_{ii'}^\text{conflict binary} = \Phi_{ii'}\left( \sum_{j = 1}^n \sum_{k} (1 - x_{ijk}) x_{i'jk} + x_{ijk} (1 - x_{i'jk}) \right).
\end{equation}

More generally, in the integer case:
\begin{equation}
 y_{ii'}^\text{conflict} = \Phi_{ii'}\left( \sum_{j = 1}^n \sum_{k} \sum_{k'} x_{ijk} x_{i'jk'} \left( \frac{\vert k - k' \vert}{\vert K \vert - 1} \right) \right)
\end{equation}

\section{Subtract}
\begin{equation}
 y_{ii'}^\text{subtract} = y_{ii'}^\text{congruence} - y_{ii'}^\text{conflict}
\end{equation}

\section{Ignore}
\begin{equation}
 y_{ii'}^\text{ignore} = \Phi_{ii'}\left( \sum_{j = 1}^n \left( \left( \sum_{k} x_{ijk} \right) \left( \sum_{k} x_{i'jk} \right) \right) \right)
\end{equation}

\section{Normalization}
In the simplest case, normalization can be switched off, in which case $\Phi_{ii'}^\text{no}(\omega) = \omega$.

Alternatively, edge weights can be divided by the average activity of nodes $i$ and $i'$:
\begin{equation}
 \Phi_{ii'}^\text{avg} (\omega) = \frac{\omega}{ \frac{1}{2} \left( \sum_{j = 1}^n \sum_{k} x_{ijk} + \sum_{j = 1}^n \sum_{k} x_{i'jk} \right) }.
\end{equation}

With Jaccard normalization, we don't just count $i$'s and $i'$'s activity and sum them up independently, but we add up both their independent activities and their joint activity, i.\,e.\,, both matches and non-matches:
\begin{equation}
 \Phi_{ii'}^\text{Jaccard} (\omega) = \frac{\omega}{ \sum_{j = 1}^n \sum_{k} x_{ijk} [x_{i'jk} = 0] + \sum_{j = 1}^n \sum_{k} x_{i'jk}[x_{ijk} = 0] + \sum_{j = 1}^n \sum_{k} x_{ijk} x_{i'jk} }.
\end{equation}

With cosine normalization, we take the product in the denominator:
\begin{equation}
 \Phi_{ii'}^\text{cosine} (\omega) = \frac{\omega}{ \sqrt{(\sum_{j = 1}^n \sum_{k} x_{ijk})^2} \sqrt{(\sum_{j = 1}^n \sum_{k} x_{i'jk})^2} }.
\end{equation}

\section{Affiliation networks}
Ignoring the qualifier variable:
\begin{equation}
 y_{ij}^\text{affiliation ignore} = \Phi_{ij}\left(\sum_{k} x_{ijk} \right)
\end{equation}

Subtracting negative from positive ties (integer case):
\begin{equation}
 y_{ij}^\text{affiliation subtract binary} = \Phi_{ij}\left(\sum_{k} k \cdot x_{ijk} \right)
\end{equation}

Subtracting negative from positive ties (binary case):
\begin{equation}
 y_{ij}^\text{affiliation subtract binary} = \Phi_{ij}\left(\sum_{k} \left( k \cdot x_{ijk} - (1 - k) \cdot x_{ijk} \right) \right)
\end{equation}

Note that the binary case is \emph{not} merely a special case of the weighted affiliation network in this case.

\section{Normalization for affiliation networks}
With \emph{activity} normalization, ties from active nodes receive lower weights:
\begin{equation}
 \Phi_{ij}^\text{activity}(\omega) = \frac{\omega}{\sum_{j = 1}^n \sum_k x_{ijk}}
\end{equation}

With \emph{prominence} normalization, ties to prominent nodes receive lower weights:
\begin{equation}
 \Phi_{ij}^\text{prominence}(\omega) = \frac{\omega}{\sum_{i = 1}^m \sum_k x_{ijk}}
\end{equation}




\chapter{Installation of \dna\ and \rdna} \label{sec:installation}
\chapterauthor{Johannes Gruber}
\FloatBarrier

This section explains how \dna\ and \rdna\ can be installed on common desktop operating systems. As \dna\ is written in \java, both \dna\ and \rdna\ rely on \java\ to work on your computer properly. This section turned out to be longer than we initially expected as we noticed that installing \java\ on different operating systems can be a bit challenging---luckily for you though we figured it out anyway and provide you with all the steps. Installing and configuring a valid \java\ Runtime Environment on your machine will thus be the first and only complicated step of the installation. However, following the simple steps below, one should not run into problems while setting up \java. The advantage of the \java\ programming language for academic software is that it both runs on different operating systems without altering the source code---once the Runtime Environment is set up---and that it is---for the most part---open source. Besides setting up the \java\ Runtime Environment, the installation of \dna\ and \rdna\ is identical on different operating systems. If you feel confident that \java\ is already correctly set up on your computer, you can therefore skip to Section~\ref{subsection:installdna} if you like. Otherwise please continue to the section for the operating system you wish to install \dna\ and \rdna\ on: 
\fullref{subsec:windows},
\fullref{subsec:mac} or
\fullref{subsec:linux}. 

For more experienced users, here is a short version of the steps described below:
\begin{enumerate}
\item{
(On Mac: install \href{https://support.apple.com/downloads/DL1572/en_US/javaforosx.dmg}{Apple's legacy version of \java}---even though we will never use it.
)
}
\item{
Install \java\ Runtime Environment (JRE) (Version 8) on your computer.
}
\item{
(On Windows and Mac: set up the ``JAVA\_HOME'' to the installation path of your JRE.)
}
\item{
Download the newest executable JAR from \href{https://github.com/leifeld/dna/releases}{github.com/leifeld/dna/releases}.
}
\item{
(On Linux: make the JAR file executable.)\newline
(On Mac: allow excetuting apps from an unidentified developer.)
}
\item{
You can now run the standalone \dna\ or continue to install \rdna\ as well.
}
\item{
Download and install \R\ (and \rstudio).
}
\item{
In \R: install the necessary \R\ packages \texttt{rJava} and \texttt{devtools}.
}
\item{
In \R: install \rdna\ via 
<<eval=FALSE, results = 'tex', message = FALSE>>=
devtools::install_github("leifeld/dna/rDNA", 
                         args = "--no-multiarch")
@
}
\end{enumerate}

\section{Windows}\label{subsec:windows}
To install the necessary \java\ Runtime Environment on your Windows computer, simply go to \linebreak \href{https://www.java.com/en/download/manual.jsp}{java.com/en/download/manual.jsp}, scroll down to and download \textbf{``Windows Offline (64-bit)''} (see Figure~\ref{fig:downljava}; download ``Windows Offline'' instead if you are using a 32-bit version of Windows). During the installation, you can accept all the default options, including the installation path.
\begin{figure}
  \includegraphics[width=\linewidth]{03-1-downljava}
  \caption{Downloading JRE from Oracle}
  \label{fig:downljava}
\end{figure}

Next, you should set \textbf{``JAVA\_HOME''} in your environmental variables to tell your Windows PC where your \java\ installation lives. This step is optional, but can prevent many issues with \java, people had in the past. To set ``JAVA\_HOME'', you need to navigate to the menu \textbf{``edit the system environment variables''}. The easiest way to get there is to hit the \raisebox{-0.1em}{\includegraphics[height=1.5\fontcharht\font`\B]{03-6-winbutton}} button on your keyboard and enter ``environment''. Windows will then search for programs and settings menus which include this title and should usually display the menu we are looking for on top.\footnote{On older versions of Windows, this might not work. On Windows 7 you can alternatively right-click on ``My Computer'' and select ``Properties $\rightarrow$ Advanced''. On Windows 8 ``Control Panel $\rightarrow$ System $\rightarrow$ Advanced System Settings''.
}
In this menu you have to find the button \textbf{``Environment variables...''}. Clicking this button should open the window shown in Figure~\ref{fig:javahome}.

Under User Variables, click New.\footnote{This sets ``JAVA\_HOME'' just for the current user. If you want to make \java\ available for all users on the computer you are working on, you can create a System Variable instead.
}
Enter the variable name \textbf{``JAVA\_HOME''} and the path to your java installation in the field \textbf{``Variable value''}. If you haven't altered the default install location, you should find \java\ in \code{"C:\textbackslash Program Files\textbackslash Java\textbackslash jre1.8.0\_151"} or if you chose to install a 32-bit version of \java\ in \code{"C:\textbackslash Program Files (x86)\textbackslash Java\textbackslash jre1.8.0\_151"} (which will cause problems though if you try to use it with a 64-bit version of \R).\footnote{Note, that you have to repeat this procedure whenever the installation path of \java\ changes, for example, whenever \java\ is updated.}
\begin{figure}
  \centering
  \includegraphics[width=0.6\linewidth]{03-2-javahome}
  \caption{Edit JAVA\_HOME to tell Windows where your \java\ lives}
  \label{fig:javahome}
\end{figure}

Windows should now recognise \java\ and be able to run \java\ commands. To test this, we can open the Command Prompt (press the \raisebox{-0.1em}{\includegraphics[height=1.5\fontcharht\font`\B]{03-6-winbutton}} button on your keyboard and simply enter ``cmd'' and then hit ``Enter'') and type a \java\ command, e.\,g.\, \texttt{``java -version''}. If the installation was successful, the output should display information about the \java-version and build as depicted in Figure~\ref{fig:javvers}.
\begin{figure}
  \centering
  \includegraphics[width=0.65\linewidth]{03-3-javaVersionCommand}
  \caption{Testing Java installation in Windows Command Prompt}
  \label{fig:javvers}
\end{figure}

After installing \java, you are ready to use \dna\ and could skip to Section~\ref{subsection:installdna} if you are not interested in installing \rdna\ as well. In order to use \rdna\ the rest of this section will explain how to install \R\ and a recommended  \href{https://en.wikipedia.org/wiki/Integrated_development_environment}{integrated development environment (IDE)} called \texttt{
\href{https://www.rstudio.com/products/RStudio/}{RStudio}}, which makes working with \R\ a lot easier and also looks a lot better than the default interface.
\paragraph{Install \R\ on Windows}\label{par:installr-win}
\begin{enumerate}
\item{
First, you need to download R from \href{https://cran.r-project.org/bin/windows/base/}{cran.r-project.org/bin/windows/base/}.
}
\item{
On the top of the page click on \textbf{Download R 3.4.3 for Windows} (or a newer version if available).
}
\item{
Install the downloaded file, e.\,g.\, ``R-3.4.3-win.exe''. Usually, it is fine to leave all default settings in the installation options.
}
\item{
Go to \href{https://www.rstudio.com/products/rstudio/download/}{rstudio.com/products/rstudio/download/}.
}
\item{
At the bottom of the page, under ``Installers for Supported Platforms'', click on the link \textbf{RStudio 1.1.383 - Windows Vista/7/8/10} (or a newer version if available). Again the default installation options are fine in most cases and can be accepted unchanged.
}
\item{
After installation, you can use \R\ by opening \rstudio.
}
\end{enumerate}
Traditionally, the first test you perform in a new programming language is to write a ``Hello, World!'' program. To do this in \R, you simply type \texttt{print(``Hello World!'')} in the ``Console'' (\textit{the window which covers the left half of \rstudio}). Alternatively, you can make \R\ perform a simple mathematical operation. If everything is set up correctly, the output should look like this:
<<eval=TRUE, results = 'tex'>>=
print("Hello World!")
# You can also use R as a calculator
2 * 3
@
The chunk of code above marks the first time we are using \R\ commands in this manual. It might be worth, to explain what this means for users who are not familiar with documents which contain \R\ code. Whenever code is shown in this manual it is decorated with a light grey background. Comments in \R\ code (i.\,e. text targeted at the user to explain what is happening in a specific line) are marked with a \#, are formatted in italic font and in dark grey. The output, which is generated by running a command, is marked by two \# and formatted in black. This means that every line which does not start with \#\# contains \R\ code which you can copy and paste to the Console in \rstudio\ and run. Alternnativly, you can also copy the code to an \R\ script and execute it by either clicking on this button \raisebox{-0.1em}{\includegraphics[height=1.5\fontcharht\font`\B]{03-5-rrun}} on the upper right of \rstudio, near the corner or you can use the shortcut ``Ctrl+Enter''. Both ways, the highlighted code or the line in which the caret is currently flashing are sent to the console and executed.
If this works fine, you should be able to continue to the next section which describes \fullref{subsection:installdna}.


\section{macOS}\label{subsec:mac}
On macOS, you have to install two versions of \java\ in order for \rdna\ to work properly. The reasons behind this are too complicated to cover here, but basically, Apple built its own version of \java, which needs to be on your machine, even though it is outdated.
Therefore we need to first install the legacy \java\ 6---which we will never use---before installing the correct \java\ Runtime Environment version 8.\footnote{If you do not wish to ever use \rdna\ or any other \R\ package which relies on \java, you might not need both versions and can just download the newest \java\ Runtime Environment. However, installing \java\ version 8 before the legacy \java\ will cause problems if you'll ever change your mind.}

First, please download the file \href{https://support.apple.com/downloads/DL1572/en_US/javaforosx.dmg}{support.apple.com/downloads/DL1572/en\_US/javaforosx.dmg} and install it, accepting all defaults. After this has finished, we can proceed to get the new version of the \java\ Runtime Environment. Go to \href{https://www.java.com/en/download/manual.jsp}{java.com/en/download/manual.jsp} and scroll down to download \textbf{``Mac OS X (10.7.3 version and above)''} (see Figure~\ref{fig:downljava2}). Again, install the program accepting all defaults.
\begin{figure}
  \centering
  \includegraphics[width=0.9\linewidth]{03-1-downljava2}
  \caption{Downloading JRE from Oracle}
  \label{fig:downljava2}
\end{figure}

After installing \java, you are ready to use \dna\ and could skip to Section~\ref{subsection:installdna} if you are not interested in installing \rdna\ as well. In order to use \rdna\ the rest of this section will explain how to install \R\ and a recommended  \href{https://en.wikipedia.org/wiki/Integrated_development_environment}{integrated development environment (IDE)} called \texttt{\href{https://www.rstudio.com/products/RStudio/}{RStudio}}, which makes working with \R\ a lot easier and also looks a lot better than \R's default interface.
\paragraph{Install \R\ on Mac}\label{par:installr-mac}
\begin{enumerate}
  \item{
  First, you need to download R from \href{https://cran.r-project.org/bin/macosx/}{cran.r-project.org/bin/macosx/}.
  }
  \item{
  On the top of the page click on \textbf{R-3.4.3.pkg} (or a newer version if available).
  }
  \item{
  Install the downloaded file. Usually, it is fine to leave all default settings in the installation options.
  }
  \item{
  Go to \href{https://www.rstudio.com/products/rstudio/download/}{rstudio.com/products/rstudio/download/}.
  }
  \item{
  At the bottom of the page, under ``Installers for Supported Platforms'', click on the link \textbf{RStudio 1.1.383 - Mac OS X 10.6+ (64-bit)} (or a newer version if available). Again the default installation options are fine in most cases and can be accepted unchanged.
  }
  \item{
  Then you need to install the program ``Xcode'' from the app store.
  }
  \item{
  After installation, you can use \R\ by opening \rstudio.
  }
\end{enumerate}
Traditionally, the first test you perform in a new programming language is to write a ``Hello, World!'' program. To do this in \R, you simply type \code{print(``Hello World!'')} in the ``Console'' (\textit{the window which covers the left half of \rstudio}). Alternatively, you can make \R\ perform a simple mathematical operation. If everything is set up correctly, the output should look like this:
<<eval=TRUE, results = 'tex'>>=
print("Hello World!")
# You can also use R as a calculator
2 * 3
@
The chunk of code above marks the first time we are using \R\ commands in this manual. It might be worth, to explain what this means for users who are not familiar with documents which contain \R\ code. Whenever code is shown in this manual it is decorated with a light grey background. Comments in \R\ code (i.\,e. text targeted at the user to explain what is happening in a specific line) are marked with a \#, are formatted in italic font and in dark grey. The output, which is generated by running a command, is marked by two \# and formatted in black. This means that every line which does not start with either \# or \#\# contains \R\ code which you can copy and paste to the Console in \rstudio\ and run. Alternatively, you can also copy the code to an \R\ script and execute it by either clicking on this button \raisebox{-0.1em}{\includegraphics[height=1.5\fontcharht\font`\B]{03-5-rrun}} on the upper right of \rstudio, near the corner or you can use the shortcut ``Ctrl+Enter''. Both ways, the highlighted code or the line in which the caret is currently flashing are sent to the console and executed.

Now unfortunatly, working with \java\ from within \R\ on a Mac is a bit messy. Apple's own version of \java, although important to have installed, does not run in combination with \R. That is why we have to tell your system which version of \java\ to use by default. To do this, we have to enter a few system commands, which you can either do in the Terminal app or directly from within \R\ using the \code{system} function:
<<eval=FALSE, results = 'tex'>>=
# list files in java_home
system("/usr/libexec/java_home -V")
##Matching Java Virtual Machines (3):
## 1.8.0_60, x86_64:	"Java SE 8"	/Library/Java/JavaVirtualMachines/jdk1.8.0...
## 1.6.0_65-b14-468, x86_64:	"Java SE 6"	/Library/Java/JavaVirtualMachines/...
## 1.6.0_65-b14-468, i386:	"Java SE 6"	/Library/Java/JavaVirtualMachines/1....

# see default version of Java
system("java -version")
##java version "1.8.0_60"
##Java(TM) SE Runtime Environment (build 1.8.0_60-b27)
##Java HotSpot(TM) 64-Bit Server VM (build 25.60-b23, mixed mode)
@
If your output looks like the above, you are ready to install \texttt{rJava}. If the first command does not show \code{1.8.0\_60, x86\_64} (or any other version staring with 1.8.), you need to install \java\ version 8 again (\textit{see above}) and possibly reboot your computer. If the second command shows \code{java version "1.6.0\_65"}, but version 1.8 is listed in the output from the first command, you can set the default by excecuting the following command:

<<eval=FALSE, results = 'tex'>>=
# Set JAVA_HOME
system("export JAVA_HOME=`/usr/libexec/java_home -v 1.8`")
@
After that, you should be able to continue to the next section which describes \fullref{subsection:installdna}.

\section{Linux}\label{subsec:linux}
%To Do: Add Suse and Debian commands where different
Since you are using Linux, we assume that you are sufficiently comfortable with using the command line. Therefore, we only provide the necessary steps for installing \java\ as commands. 

First check if \java\ might already be installed:
<<eval=FALSE, engine = 'bash', eval = FALSE, results = 'tex'>>=
$java -version
@
If not, install it, e.\,g.\, via \code{APT}:
<<eval=FALSE, engine = 'bash', eval = FALSE, results = 'tex'>>=
$sudo apt-get install default-jre
@
Optional: You can also install the \java\ development kit at this point, which is sometimes recommended for working with \R\ and \java.
<<eval=FALSE, engine = 'bash', eval = FALSE, results = 'tex'>>=
$sudo apt-get install default-jdk
@
After installing \java, you are ready to use \dna\ and could skip to Section~\ref{subsection:installdna} if you are not interested in installing \rdna\ as well. In order to use \rdna\ the rest of this section will explain how to install \R\ and a recommended  \href{https://en.wikipedia.org/wiki/Integrated_development_environment}{integrated development environment (IDE)} called \texttt{\href{https://www.rstudio.com/products/RStudio/}{RStudio}}, which makes working with \R\ a lot easier and also looks a better than the default GUI.
\paragraph{Install \R\ on Linux}\label{par:installr-linux}
\begin{enumerate}
  \item{
  Since the version of \R\ on the default repositories tends to be fairly outdated, we add the repository of the Comprehensive R Archive Network (CRAN) to our sources.list:
 <<eval=FALSE, engine = 'bash', eval = FALSE, results = 'tex'>>=
$sudo add-apt-repository "deb [arch=amd64,i386] https://cran.rstu
  dio.com/bin/linux/ubuntu artful/"
@ 
  \textbf{Note, that you need to replace \code{/ubuntu artful/} with your flavour and version of Linux}. Visit \href{https://cran.rstudio.com/bin/linux/}{CRAN} to see which ones are available. \code{cran.rstudio.com} is also just one of several \href{https://cran.r-project.org/mirrors.html}{CRAN mirrors}, so you could replace it with a different one if you prefer.
  }
  \item{
  Next, you need to add \R\ to your keyring. Seen below is how you would accomplish that in Ubuntu:
<<eval=FALSE, engine = 'bash', eval = FALSE, results = 'tex'>>=
$gpg --keyserver keyserver.ubuntu.com --recv-key E084DAB9
$gpg -a --export E084DAB9 | sudo apt-key add -
@ 
Or
<<eval=FALSE, engine = 'bash', eval = FALSE, results = 'tex'>>=
$sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E2
  98A3A825C0D65DFD57CBB651716619E084DAB9
@ 
  }
  \item{
  Update apt and install \R\ (and r-base-dev if you wish to compile packages from source):
<<eval=FALSE, engine = 'bash', eval = FALSE, results = 'tex'>>=
$sudo apt-get update
$sudo apt-get install r-base install r-base-dev
@ 
  }
  \item{
  Now install \rstudio\ via gdebi (and install gdebi first if you don't already have it)\footnote{Alternatively, you can download an installation file from \href{https://www.rstudio.com/products/rstudio/download/}{rstudio.com/products/rstudio/download/}.}:
<<eval=FALSE, engine = 'bash', eval = FALSE, results = 'tex'>>=
$sudo apt-get install gdebi-core
$wget https://download1.rstudio.org/rstudio-1.1.419-amd64.deb
$sudo gdebi -n rstudio-1.1.419-amd64.deb
$rm rstudio-1.1.419-amd64.deb
@   
  }
  \item{
  (Up until version 1.1.423, \rstudio\ depends on an outdated version of \texttt(libgstreamer). You thus either need to use the new version (which is currently just a preview) or install the old version of \texttt(libgstreamer) using the method explained in this \href{https://mikewilliamson.wordpress.com/2016/11/14/installing-r-studio-on-ubuntu-16-10/}{blogpost}.)
  }
  \item{
  After the installation has finished, you can use \R\ by opening \rstudio.
  }
\end{enumerate}
Traditionally, the first test you perform in a new programming language is to write a ``Hello, World!'' program. To do this in \R, you simply type \code{print(``Hello World!'')} in the ``Console'' (\textit{the window which covers the left half of \rstudio}). Alternatively, you can make \R\ perform a simple mathematical operation. If everything is set up correctly, the output should look like this:
<<eval=TRUE, results = 'tex'>>=
print("Hello World!")
# You can also use R as a calculator
2 * 3
@
The chunk of code above marks the first time we are using \R\ commands in this manual. Since it looks similar to the terminal commands we used above, you probably have no problem reading it. But just in case, it might be worth to explain what you see there: whenever code is shown in this manual it is decorated with a light grey background. Comments in \R\ code (i.\,e. text targeted at the user to explain what is happening in a specific line) are marked with a \#, are formatted in italic font and in dark grey. The output, which is generated by running a command, is marked by two \# and formatted in black. This means that every line which does not start with \#\# contains \R\ code which you can copy and paste to the Console in \rstudio\ and run. Alternnativly, you can also copy the code to an \R\ script and execute it by either clicking on this button \raisebox{-0.1em}{\includegraphics[height=1.5\fontcharht\font`\B]{03-5-rrun}} on the upper right of \rstudio, near the corner or you can use the shortcut ``Ctrl+Enter''. Both ways, the highlighted code or the line in which the caret is currently flashing are sent to the console and executed.

Now before we can actually run \rdna, we need to associate \java\ with R. To do this, you can either go back to the terminal, or you can invoke a system command directly from within \R\ using the \code{system} function:
<<eval=FALSE, engine = 'bash', eval = FALSE, results = 'tex'>>=
$sudo R CMD javareconf
@
Or:
<<eval=FALSE, results = 'tex'>>=
system("sudo R CMD javareconf")
@
After this is finished, you are now set to start installing \dna\ and the \rdna-package themselves.

\section{Installing the programs themselves}\label{subsection:installdna}
Once \java\ is set up correctly, you can simply download the latest version of \dna\ as a JAR file from \href{https://github.com/leifeld/dna/releases}{github.com/leifeld/dna/releases} (\textit{see Figure~\ref{fig:downloadjar}}). JAR or \texttt{.jar} files are technically archive files which usually contain a computer program written in \java, along with all the pictures and libraries necessary to run the program. Once the download is finished, you can start the program by double-clicking on the downloaded file. However, on Linux, it is sometimes necessary to make the file executable first (e.\,g.\, via \code{\$chmod +x /path/to/your/dna.jar} or using \href{https://askubuntu.com/a/484719/570716}{a GUI-method}). On newer version of macOS, a program from an "unidentified developer" (i.\,e., if the program has not been registered with apple) needs to be made a security exception before you can run it. To do so for \dna\, control-click the program's icon, then choose ``Open'' from the shortcut menu. If clicking on the file does not open the program on a windows machine, right-click on the \texttt{.jar} file $\rightarrow$ ``Open with'' $\rightarrow$ ``Use another app'' and then navigate to the file \code{"C:\textbackslash Program Files\textbackslash Java\textbackslash jre1.8.0\_151\textbackslash bin\textbackslash javaw.exe"}. 

If you are not interested in using \rdna, you can now skip to the \hyperref[sec:dna-prep]{next section}.
\begin{figure}
  \includegraphics[width=\linewidth]{03-4-downloadjar}
  \caption{Download \dna\ jar file from GitHub releases page}
  \label{fig:downloadjar}
\end{figure}

At this point, I assume that you have installed \R\ and have at least a minimal understanding of how the program works. If that is not the case, you might want to jump back to where we explain how to install \fullref{par:installr-win}, \fullref{par:installr-mac} or \fullref{par:installr-linux}. If you have already done this, we can go ahead and install \rdna\ from within \R. First, we need to install the package \texttt{rJava} \citep{urbanek2016rjava}, which is the most important dependency of \rdna:
<<eval=FALSE, results = 'tex', message = FALSE>>=
install.packages("rJava")
@
To see if this worked, or to troubleshoot potential problems, we can run a couple of \java\ commands from within \R:
<<eval=TRUE, results = 'tex', message = FALSE>>=
library("rJava")
# 1. initialize JVM
.jinit()
# 2. retrieve the Java-version
.jcall("java/lang/System", "S", "getProperty", "java.version")

# 3. retrieve JAVA_HOME location
.jcall("java/lang/System", "S", "getProperty", "java.home")

# 4. retrieve Java architecture
.jcall("java/lang/System", "S", "getProperty", "sun.arch.data.model")

# 5. retreive architecture of OS (This should have 64 in it if step 4 displays
# "64")
.jcall("java/lang/System", "S", "getProperty", "os.arch")

# 6. retrieve architecture of R as well (This should again have 64 in it if 
# step 4 and 5 display 64)
R.Version()$arch
@
Now what you want to make sure, in case something is not working correctly with \texttt{rJava}, is if the architectures of \java, your operating system and your version of \R\ match (\textit{see comments 4., 5., and 6. in above's code chunk}).

Once this is done, you should install the package \texttt{devtools} \citep{wickham2016devtools}, which permits installing \R\ packages from GitHub.
<<eval=FALSE, results = 'tex', message = FALSE>>=
install.packages("devtools")
@
Since we only need one function from the package \texttt{devtools} at this point, it is not necessary to invoke the \code{library} command to load the whole package. Instead you can write \texttt{``devtools::''} and then type the function you want 
to use.\footnote{The option \code{args = "--no-multiarch"} should normally not be necessary, but prevents errors on some operating systems. Since \texttt{devtools} tries to test both 32-bit and 64-bit version of a package during installation, the process inevitably fails as only one architecture of \java\ is available.}
<<eval=FALSE, results = 'tex', message = FALSE>>=
devtools::install_github("leifeld/dna/rDNA", 
                         args = "--no-multiarch")
@
After this is done as well, the final step of the installation is to test if \rdna\ can be loaded into \R\ correctly and to perform a basic operation with it---opening \dna\ from within \R. In order to do so, you first need to download \dna, which can also be done in \R\ with the \code{download.file} command (\textit{see Section~\ref{sec:rdna} for more information about this code chunk}).
<<eval=FALSE, results = 'tex', message = FALSE>>=
# download two files necessary to test rDNA
download.file(
  "https://github.com/leifeld/dna/raw/master/manual/dna-2.0-beta20.jar",
  destfile = "dna-2.0-beta20.jar", mode = "wb")         # download DNA jar

# load library
library("rDNA")

# initialise the file you just downloaded
dna_init("dna-2.0-beta20.jar")

# start up DNA from R with the sample file to see if everything worked
dna_gui(infile = dna_sample())
@
If these commands can be executed correclty, you are ready and set to use both \dna\ and \rdna. How you can do so will be described in the rest of this manual.






\chapter{Using DNA: Preparation of your DNA Workspace} \label{sec:dna-prep}
\chapterauthor{Felix Rolf Bossner and Johannes Gruber}
\FloatBarrier

After installing the program (see Section~\ref{sec:installation}), you can now create your first DNA database for your own research project. How you set up a DNA database will mainly depend on the needs of your personal research design---which should usually be clear before you start analysing data. Therefore, \dna\ can be customised during the creation of a new database in accordance with how you are planning to use the tool.

\section{Creating a new DNA database}\label{sec:createnewdb}
In order to create a new DNA database file, you have to click on the index tab \textbf{``File''} (in the upper left corner of your DNA program window) and select the option \textbf{``New DNA database''} (\textit{see Figure~\ref{fig:newdb}}). As a result, a new window will open (\textit{see Figure~\ref{fig:dbchoose}}), in which you find a menu that provides you with a step-by-step guidance for specifying the configuration of your personal DNA database 
\begin{figure}
  \includegraphics[width=\linewidth]{04-1-newDatabase}
  \caption{Starting a new Database}
  \label{fig:newdb}
\end{figure}



\begin{figure}
  \includegraphics[width=\linewidth]{04-3-chooseDB}
  \caption{Choose if database will be stored locally or remotly}
  \label{fig:dbchoose}
\end{figure}

Clicking on the first tab in the sidebar of this menu---\textbf{``Database''} (\textit{see Figure~\ref{fig:dbchoose}})---opens a menu, which allows you to choose the file name and storage location of your database. For this first step of your set-up, DNA provides you with two options in respect to the type of database, in which your data is stored. Which of these options best fits your research project is dependent on the circumstances of your coding process:

\begin{addmargin}[1cm]{1cm}
The preset option \textbf{``Local .dna file''} means, that the dataset is stored in a local file
\footnote{Technically an SQLite file.
} on your PC or device. This file, with the file extension .dna, can be moved on your machine, sent via email, uploaded and shared via a cloud file hosting service---such as Dropbox---and can generally be treated in the same way as any other file PC users are familiar with. A local .dna file will be sufficient in most user scenarios, for example, if you employ a single coder working on a single computer, if multiple coders work on a single dataset at non-overlapping intervals or when multiple coders work at the same time on different datasets, which you merge after the coding process (\textit{see Section~\ref{subsec:merge}}). For most users, this simpler option will adequate in order to use \dna\. It is not necessary to be familiar with setting up and managing an SQLite or MySQL database. If you think, the scenarios described above cover your intended use of \dna, you can now jump to the next section and start \fullref{sec:createlocal}.

However, for more experienced user or research projects in which several coders want to work on the same database at the same time, a second option was included into \dna\: \textbf{``Remote database on a server''}. This stores your data in a  MySQL database which could be stored locally on your machine---which would defy the purpose though---on a private sever---such as a Network-attached storage (NAS)---or on an online Cloud server. You should select this option if you employ a single coder working on multiple devices or multiple coders working on a single dataset at the same time. The preconditions for using this type of storage are that all coders have a stable connection to the database during the coding process---e.\,g.\, via the internet---and that you \href{https://dev.mysql.com/doc/mysql-getting-started/en/}{set up an online MySQL database} in advance. If this is how you want to proceed, you can now jump directly to the section which descibes the necessary steps for  \fullref{subsec:usingremote}.
\end{addmargin}




\subsection{Creating a local DNA file}\label{sec:createlocal}
\begin{enumerate}
\item{
Click on the button \textbf{``Browse''} (\textit{see Figure~\ref{fig:dbchoose}}). Now a pop-up menu---similiar to the one shown in \textit{Figure~\ref{fig:path}}---should be open.
}

\item{
In this pop-up menu, you can choose the storage location of your database on your local device from the \textbf{``Save in''} slide down menu. Enter the name of your database in the field \textbf{``File Name''} and confirm your choices by pressing the \textbf{``Save''} button \textit{(see Figure~\ref{fig:path}}). Now the pop-up menu will close.
}
\begin{figure}
  \centering
  \includegraphics[width=0.75\linewidth]{04-4-path}
  \caption{Choose location of database window}
  \label{fig:path}
\end{figure}

\item{
\textbf{Next, it is important, that you confirm your choices again by pressing the ``Apply'' button} (\textit{see Figure~\ref{fig:apply}}). If you forget to press this button, you cannot create the database in the final step, because the program will report ``No database selected'' (\textit{see Figure~\ref{fig:nodb}}).
}
\begin{figure}
  \includegraphics[width=\linewidth]{04-5-apply}
  \caption{Apply database choice}
  \label{fig:apply}
\end{figure}
\end{enumerate}

If you just employ a single coder and don´t want to change or supplement the preset standard research variables (``person'', ``organization'', ``concept'', ``agreement'') or types of codeable statements (``Statement'', ``Annotation''), you can now proceed directly to the \hyperref[subsec:finalstep]{final step}. If you use this manual as a beginner´s tutorial for working with \dna, however, it would be helpful to follow the steps outlined in sections~\ref{subsec:userman} and \ref{subsec:stattype} in order to gain a better understanding of the \dna's potential uses and its functions.




\subsection{Creating and using a remote database (MySQL)}\label{subsec:usingremote}
Before you can configure \dna\ for working with a remote MySQL database, it is necessary to execute at least three basic operations in MySQL (\textit{see Figure~\ref{fig:mysql}}).\footnote{For a detailed introduction to database management with MySQL see \href{https://dev.mysql.com/doc/mysql-getting-started/en/}{dev.mysql.com/doc/mysql-getting-started}.
}
\begin{figure}
  \includegraphics[width=\linewidth]{04-6-mysql}
  \caption{Create MySQL database}
  \label{fig:mysql}
\end{figure}

\begin{enumerate}
\item{
You have to create a database on your MySQL server (\textit{usually by the command} \newline 
\code{CREATE DATABASE 'DatabaseName'}).
}
\item{
As you probably don´t want to allow all coders access to all other databases stored on your MySQL server, you should create distinct user profile(s) for the coding process of your \dna\ project. Even if \dna\ itself allows for 
\hyperref[subsec:userman]{managing multiple different coder roles}, we recommend to create separate user profiles for each of the individual coders---especially if they simultaneously edit the content of your database. It is also advisable to create passwords for the access to your database, not only for safety reasons, but also because DNA sometimes has problems with signing in users without a password. Consequently you would use the 
\textbf{\code{CREATE USER 'Username'@'\%' IDENTIFIED BY 'Password'}}
  command. Note, that in this step you could also restrict the respective users access to your database to a specific device by replacing '\%' through a particular server address if this is necessary.
}
\item{
Finally, you have to equip the users with the necessary rights to edit your database. In MySQL simply use
\textbf{\code{GRANT ALL PRIVILEGES ON Databasename.* TO 'Username'@'\%'}}, as it makes more sense to specify distinct user roles and rights directly in \dna\ (\textit{see~\ref{subsec:userman}}), where options were tailored to fit discourse network-analytical coding purposes.
}
\end{enumerate}
Once the MySQL database is set up, you only have to select the option \textbf{``Remote database on a server''} in the first tab of the sidebar menu \textbf{``Database''} in DNA (\textit{see \fullref{sec:createnewdb}}) and enter the respective username and password created in the previous step in the respective fields \textbf{``User''} and \textbf{``Password''} as well as to specify the server address of the database, with which you want to connect, in the field \textbf{``mysql://''}. If you want to access the database remotely from another device, you have to indicate the URL or IP-address of your host server, the port (which is 3306 in default, but can be \href{https://dev.mysql.com/doc/refman/5.5/en/connecting.html}{configured manually}) and the name of your database in the format \textbf{``Hostserveraddress:Port/Databasename''}. If you use DNA on the device hosting the database you can instead use the configuration shown in \textit{Figure~\ref{fig:localhost}} (\textbf{``localhost/Databasename''}). By clicking the button \textbf{``Check''} you can now check if DNA is able to connect to your database. If this is successful, you will receive the message \textbf{``Ok. Tables will be created''} \textit{(see Figure~\ref{fig:localhost})}; if not, DNA will report  \textbf{``Error: Connection could not be established''}. In case of the latter, you should check the validity of your server address, username and password and---if necessary---repeat the steps outlined above. It should be noted that---for security reasons---MySQL doesn´t allow remote access with the ``root'' superuser-profile in most cases. Similar to the generation of a local .dna file, it is finally important, that you confirm your choices again by pressing the \textbf{``Apply'' button} \textit{(see Figure~\ref{fig:localhost})}. If you forget to press this button, you cannot create the database in the \hyperref[subsec:finalstep]{final step}, because the program will report ``No database selected'' \textit{(see Figure~\ref{fig:nodb})}. 
\begin{figure}
  \includegraphics[width=\linewidth]{04-7-localhost}
  \caption{Connecting to local MySQL database}
  \label{fig:localhost}
\end{figure}





\section{User Management: Multiple Coders and Permissions}\label{subsec:userman}
This second step of preparing your DNA workspace allows you to generate multiple user identities with different sets of rights for different coders. Thus, you can specify for each coder, which parts of the dataset each user can see or edit and thereby pre-structure your coding and research process. In order to do so, click on  second tab \textbf{``Coder''} in the sidebar of the ``Create new database'' menu (\textit{see Figure~\ref{fig:addcoder}}).
\begin{figure}
  \includegraphics[width=\linewidth]{04-8-addcoder}
  \caption{Adding a second coder to the database}
  \label{fig:addcoder}
\end{figure}

In the main window (\textit{see Figure~\ref{fig:addcoder}}) you can now see a list with all coders and how many of the 12 possible actions they are permitted to perform. Now you can either add a new user profile by clicking the \textbf{``Add''} button (\textit{see Figure~\ref{fig:addcoder}}) or select an existing coder and adjust her/his users rights by clicking on the user and then on the \textbf{``Edit''} button (\textit{see Figure~\ref{fig:editcoder}}). Both options will open the pop-up menu shown in (\textit{see Figure~\ref{fig:coderdetail}}).
\begin{figure}
  \includegraphics[width=\linewidth]{04-9-coderdetail}
  \caption{Configuring coder permissions}
  \label{fig:coderdetail}
\end{figure}

This pop-up menu allows you to configure an individual profile for each coder in three simple steps:
\begin{enumerate}
\item{
You can choose the \textbf{colour} for the coder (\textit{see Figure~\ref{fig:coderdetail}, step 1}). It is recommended to choose different---if possible---divergent colours for each coder, because this permits you to detect at the first glance, which user coded which statement, as every coded statement is marked in the individual colour of its respective coder \textit{(see middle column of Figure~\ref{fig:chacoder})}.
}
\item{
You can enter the preferred name of each coder in the field \textbf{``Name''}. If possible with respect to data protection rules, it is recommended to use the real names of the coders. This makes it easier for them to select their profile (in the upper left of the main program window) the first time they start the program (\textit{see Figure~\ref{fig:chacoder}}).
}
\item{
The final step allows you to configure the \textbf{permissions} of each coder individually by (de)selecting the respective rights via a click (\textit{see Figure~\ref{fig:coderdetail}, step 3}). Each new user has all of the 12 configurable permissions in the preset mode. Which parts of the dataset an individual coder should be able to see or edit, should depend on your coding process. For better orientation a few practical implications of the 12 configurable permissions are listed in \textit{Table~\ref{tab:permissions}}
. Please keep in mind, that every user can see and change to other user identities either accidentally or because of non-compliance, as s/he has to select her/his role the first time s/he starts the program and can change her/his role anytime \textit{(see above and Figure~\ref{fig:chacoder})}}
\end{enumerate}
\begin{figure}
  \includegraphics[width=\linewidth]{04-10-chacoder}
  \caption{Change coder identity}
  \label{fig:chacoder}
\end{figure}

\begin{figure}
  \includegraphics[width=\linewidth]{04-11-edicoder}
  \caption{Edit coder details}
  \label{fig:editcoder}
\end{figure}

Finally you approve your choices by clicking the \textbf{OK} button \textit{(see Figure~\ref{fig:coderdetail}, step 4)}. It is possible to change the settings either in the ``new database'' menu by selecting the respective user and clicking the \textbf{``Edit''} button (\textit{see Figure~\ref{fig:chacoder}}) or changing the coder settings in the main menu. To do so, simply select a coder from the drop-down menu in the window at the top left of the main menu and then push the pencil icon underneth. The same menu as depicted in Figure~\ref{fig:chacoder} will open up again.
%Felix wanted to link this somewhere(github.com/).

% table doesn't float, which is not ideal but seems to be the only way it breaks over pages?
\rowcolors{3}{grey}{}
\begin{tabularx}{\linewidth}{@{}c X@{}}
\caption{User permissions explained}\label{tab:permissions}\\ %generate warning but works normal
\toprule
\textbf{Permission} & \textbf{Practical Implication} \\
\midrule
\endhead
  add documents & The user can add new documents (i.\,e., raw data) manually (via copy and paste or retyping) to the database $\Rightarrow$ user has (also) a research function. \\
  
  import documents & The user can import new documents from other sources like .txt or other .dna files to the database or recode the metadata of multiple documents $\Rightarrow$ user has (also) a research function. \\

  delete documents & The user can delete documents from the database or dataset. This option requires at least the other permission ``view others' documents''  if the user has an organizing or editing function (structuring database for coding by other users) or the permission ``add documents'' and ``add statements'' if the coder determines own codes and organizes her/his own set of data. \\

  edit documents & The user can edit her/his own documents (i.\,e., raw data),  but not necessarily the codings in these documents that were made by other users---which would require the permission ``edit others' statements''---or the documents uploaded by other users---which requires the permission ``edit others' documents''. This option requires at least the other permission ``add documents'' or ``import documents'' and should be selected  if the user determines own codes and organizes her/his own set of data or acts as a researcher
  %?
  for the other coders. \\

  view others' documents & The user can view the documents uploaded by other users. This option is necessary for a collaborative coding process in which only a part of the users selects and uploads the raw data (i.\,e., documents) for all other users. The option should not be selected if each coder comes up with own codes and organizes her/his own set of data. \\

  edit others' documents & The user can edit the documents uploaded by other users. This option requires at least the other permission ``view others' documents'' and should be selected if a user organizes or edits the raw data provided by other users. \\

  add statements & The coder actually codes the data by creating and editing statements. If only a part of the users select and upload the raw data  this option requires the additional permission ``view others' documents''. If the coder suggests own codes and organizes her/his own set of data this option requires either the additional permission \textit{``add documents''} or \textit{``import documents''}. \\

  view others' statements & The coder can view the statements coded by other users. For example  the Coder ``DNA User'' would not see the yellow statement of the Coder ``Admin'' in Figure~\ref{fig:chacoder} if this option was deselected for her/his user role. This option should be de-selected if you want to establish a blind coding process. \\

  edit others' statements & The coder can edit or correct the statements coded by other users. This option requires at least the other permission ``view others' statements'' and should only be selected for few users with an \textit{organizing},  \textit{controlling} or \textit{editing function}. \\

  add coders & The user can add new coders (\textit{see Section~\ref{subsec:userman}}). This option should only be selected for few users with an \textit{organizing} function. \\

  edit statement types & The user can change or complement the variables of interest (\textit{see Section~\ref{subsec:stattype}}). This option should only be selected for very few users or the researchers
  %?
  themselves because possible adjustment of these variables is usually only necessary in cases when the research design and/or research questions change fundamentally. \\
  
  edit regex settings & The user can specify keywords which are highlighted in the text, along with a text color.
  %To DO%
  %(\textit{see Section~\ref{subsec:}}).%
  For example, in \textit{Figure~\ref{fig:chacoder}} the word ``colors'' is highlighted in the raw data text (middle column), because it was specified as a keyword in the \textit{regex highlighter sidebar} in the bottom left of the DNA window. If a user does not have the right to edit the regex setting, the buttons ``Add'' and ``Remove'' in this highlighter would be hidden, but the keyword would nevertheless be visibly highlighted in the text and listed in the regex highlighter sidebar. Thus, if you specify a distinct set of theory based keywords in advance in order to render the coding procedure semi-automatic%
  %is semi-automatic the correct term?%
  , you should not enable this option or select it only for \textit{few users}, as the respective coder could change the keywords. However, if you don´t have a theoretically relevant set of keywords in advance or just specify them as a assistance for your coders, you can allow them to formulate such keywords by themselves. \\

\bottomrule
\end{tabularx}




\section{Statement Types and Variables} \label{subsec:stattype}
Clicking on the third tab in the sidebar of the ``Create new database'' menu---\textbf{``Statement Types''} (\textit{see Figure~\ref{fig:stattype}})---opens a menu, which allows you to adjust or supplement either the variables or the types of statements, which your coders derive from the raw data.
\begin{figure}
  \includegraphics[width=0.9\linewidth]{04-12-stattype}
  \caption{Edit Statement Types}
  \label{fig:stattype}
\end{figure}

\subsection{Adjusting the variables of interest} \label{sec:adjusvarint}
The statement type \textbf{``DNA Statement''} represents a text portion of your raw data, where an actor reveals her/his opinion/belief/etc. about an issue. Thus, the main task of your coder(s) is to identify such text portions and gain the relevant data about the actor or his opinion/belief/etc. Your research question or theory should not only dictate what kind of information should be coded as statements, but also which relevant variables of this information should be captured by the coder. As you can see in the ``Statement Types'' menu, DNAs default configuration allows capturing four variables. Selecting \textbf{``DNA Statement''} and clicking on the button \textbf{``Edit''} (\textit{see Figure~\ref{fig:stattype}}) opens a pop-up window (\textit{see Figure~\ref{fig:statdetail}}), which reveals the nature of this four preconfigured variables, along whose lines the coders can collect information:

\begin{figure}
  \centering
  \includegraphics{04-13-statdetail}
  \caption{Edit Statement Type details}
  \label{fig:statdetail}
\end{figure}

\begin{itemize}
  \item the \textbf{person} who makes the statement.
  \item the \textbf{organization} the speaker is affiliated with.
  \item the \textbf{concept} (opinion/belief/etc.) which is raised by the actor.
  \item a dummy variable indicating whether the actor \textbf{agrees} with the concept or not.
\end{itemize}

Furthermore the pop-up window depicted in \textit{Figure~\ref{fig:statdetail}} shows, that each variable is assigned to a specific data type: While ``person'', ``organization'' and ``concept''---according to their nature as nominal variables---will be coded by a short text, ``agreement'' as a dichotomous variable will be coded as a 
\href{https://en.wikipedia.org/wiki/Boolean_data_type#Python.2C_Ruby.2C_and_JavaScript}{boolean data type}
, which accordingly only allows for two forms (either agreement or non-agreement). Neither the data type nor the name of the variables can be changed directly. However by selecting a variable and clicking on the \textbf{trash symbol} (on the right side of the ``Add Variable'' button, \textit{Figure~\ref{fig:statdetail}}, step 4) you can delete a variable and subsequently replace it by a new one. Generating a new variable---either to replace one of the preconfigured variables or because you are interested in an additional or a different set of variables---is possible in five simple steps:

\begin{enumerate}
\item{
You have to \textbf{select an existing variable} in order to activate the variable menu (\textit{see 1, Figure~\ref{fig:statdetail}}).
}
\item{
Now you can enter the \textbf{name} of the new variable in the \textbf{text field} at the bottom of the pop-up window (\textit{see 2, Figure~\ref{fig:statdetail}}). For example, in \textit{Figure~\ref{fig:statdetail}} we are interested in collecting the age of the person who makes the statement. Please note, that DNA does not allow spaces in variable names. Putting a space in the variable name will disable the ``Add Variable'' button necessary for step 4.
}
\item{
Now you can choose the \textbf{data type} of your variable by \textbf{clicking} on one of the \textbf{four options}. In our example, we choose the option ``integer'', as the age of a person is neither a nominal nor a dichotomous variable, but an 
\href{https://en.wikipedia.org/wiki/Integer_(computer_science)}{integer number}%
%Should be common sense. Is link needed?%
) (\textit{see Figure~\ref{fig:statdetail}, step 3}).
}
\item{
You have to click on the \textbf{``Add-Variable''} button, which has the form of a \textbf{green plus symbol} (\textit{see 4, Figure~\ref{fig:statdetail}}). If this button is disabled, you probably did not select a existing variable (step 1) or have a space in your variable name (see step 2).
}
\item{
Click the \textbf{``OK''} button to confirm your choices (\textit{see Figure~\ref{fig:statdetail}, step 5}).
}
\end{enumerate}

Please note, that---for the statement type ``DNA Statement''---you should only specify variables, in which you have an actual research interest in and that accordingly have to be coded for all statements by all coders. If you are interested in additional and optional information about some statements, you can specify them as variables of the other preconfigured statement type---\textbf{``Annotation''}.

\subsection{Adjusting the statement types}
There are very few research scenarios, in which it is necessary to complement the two existing types of statements with further ones or with an adjustment of type ``DNA statement''. One of them would be, if you study two parallel yet different research questions, which employ the same dataset \textit{and} the same coders at the same time. In this case, you could \textbf{first rename} the statement type ``DNA Statement'' by \textbf{selecting} it from the statement type menu, clicking the \textbf{``Edit''} button (\textit{see Figure~\ref{fig:stattype}}), entering the new name (in this case: ``Statement for Research Project 1'') in the \textbf{text field on top of the pop-up window} (\textit{see Figure~\ref{fig:statdetail}}) and pressing the \textbf{``OK''} button (\textit{see 5, Figure~\ref{fig:statdetail}}). 
Subsequently you would open a \textbf{new pop-up window} by clicking on the \textbf{``Add''} button in the statement type menu (\textit{left button in Figure~\ref{fig:stattype}}). Then \textbf{name} the new statement type (in this case: ``Statement for Research Project 2'') in the text field on top of the pop-up window and \textbf{choose a color} (different from the other type) by clicking on the colored button next to this text field. Then you also need to \textbf{specify the relevant variables} synchronous to the procedure depicted in Section~\ref{sec:adjusvarint}.
However, please evaluate carefully, if it is really neccesary for your second research interest that you specify a second statement type or if it would be possible to either conceptualize it as a variable of the existing statement type or study it sequentially or with a different set of coders (and therefore in a different \dna\ dataset). \textbf{More than two statement types (besides ``Statement'' and ``Annotation'') can cause a confusion of the coders and therefore compromise the validity of the coding procedure}.

\section{Final step: Approving your workspace and creating the DNA file} \label{subsec:finalstep}
Finally, clicking on the \textbf{``Summary''} tab in the sidebar of the ``Create new database'' menu provides you with a summary of your choices in respect to the configuration of your coding process (\textit{see Figure~\ref{fig:summary}}). After controlling each of the three information you can now create your database by clicking on the \textbf{``Create database''} button. If this button is disabled and you get the error ``No database selected'' (\textit{see Figure~\ref{fig:nodb}}), you probably forgot to click the \textbf{Apply button} after specifying your database (\textit{see Section~\ref{sec:createlocal}, step 3}). After creating the database, the new database will open in the main DNA window (\textit{see Figure~\ref{fig:newdb}}) and you can proceed towards loading up and organizing the raw data.
\begin{figure}
  \includegraphics[width=\linewidth]{04-14-summary}
  \caption{Summary of your about to be created \dna\ database}
  \label{fig:summary}
\end{figure}

\begin{figure}
  \includegraphics[width=\linewidth]{04-15-nodb}
  \caption{No databse selected (e.\,g.\, if choice was not applied)}
  \label{fig:nodb}
\end{figure}






\chapter{Using DNA: Importing and Organizing your Raw Data} \label{sec:dna-import}
\chapterauthor{Felix Rolf Bossner}
\FloatBarrier
This section describes how to upload and organize your research project's raw data---i.\,e.\, the text files (newspaper articles, press releases etc.) containing the uncoded statements---in DNA. First it will be layed out how you open an existing database---either locally or from a remote location. Then you will learn how to import new documenst into \dna---either by importing one document at a time or by selecting mutliple documents for import. Finally, we tell you how you can organise the documents in your database and how you can change your docuemtns' metadata.

\section{Opening an existing DNA database}
First of all, you have to choose, in which \dna\ Database you want to upload and process your data. To open a \dna database, simply follow the steps depicted in Figure 1: First, click on the index tab \textbf{``File''} and select the option \textbf{``Open \dna\ database''} (\textit{see Figure~\ref{fig:opendb}, step 1}). As a result, a pop-up window will appear, which allows you to choose between opening a \textbf{``Local .dna file''} or a \textbf{``remote database on a server''}. If your database is stored on a remote server, you should choose the second option and repeat the procedure outlined in \fullref{subsec:usingremote}.  If your dataset is stored in a folder on your local PC or device, you can proceed with the preset option and click on the button \textbf{``Browse''} (\textit{see Figure~\ref{fig:opendb}, step 2}), which will open a further pop-up window, in which you can find your database by choosing its storage location from the  \textbf{``Save in''} slide down menu  (\textit{see step 3}), selecting the respective database (\textit{see step 4}) and clicking on the button \textbf{``Open''} both in the pop-up  and the ``Open existing database...'' window (\textit{see steps 5 and 6}).
\begin{figure}
  \includegraphics[width=\linewidth]{05-1-opendb}
  \caption{Opene \dna database}
  \label{fig:opendb}
\end{figure}

\section{Importing Documents (Raw Data)}\label{subsec:importdoc}
There are four different---partly semi-automatic---ways to upload your raw data and related descriptive information (title, date, author, source, section and type of document) into \dna: Importing single Documents manually via Copy and Paste, Importing multiple Documents semi-automatically from text files, Importing Documents from other DNA databases and using \rdna\ to import data which is already available in R (WIP!)%
%(\textit{see Section~\ref{subsec:importr}})%
. All four will be explained in detail in this section.

\subsection{Importing single Documents manually via Copy and Paste}
The most basic way to import data to \dna\ requires you to manually copy and paste the content and the descriptive information for each of your documents into the text fields of a pop-up window, which you open by clicking on the index tab \textbf{``Documents''} and selecting the option \textbf{``Add new document''} (\textit{see Figure~\ref{fig:adddoc}}). This window has eight text boxes, in which you can enter information from and about your source data (\textit{see Figure~\ref{fig:adddoc}}):

\begin{itemize}
  \item{
  The field \textbf{``title''} is mandatory and may include any kind of information, for instance a unique ID if you plan to collect additional information about the articles in a separate database. Duplicate article titles are not allowed.
  }
  \item{
The field \textbf{``date''} is also mandatory and preset on the current time and day. You can change it by either clicking on the year, month, day or time and adjusting the respective value via the arrows on the right or by manually entering the date in the format ``YYYY-MM-DD hh:mm:ss''. Please make sure you enter the date correctly because otherwise the algorithms for longitudinal data
%[longitudinal data](http://github,com) #not sure where this link is supposed to go
 will not work properly.
  }
  \item{
  The fields \textbf{``author''}, \textbf{``source''}, \textbf{``section''} and \textbf{``type''} are optional, but this additional information can help you to efficiently organize your data and ensure the reproducibilty, transparency and future usage of your research project. You can enter these information either manually or select an author, source, section or type you specified for a previously added document from the drop-down menu, which appears when you click on the downward arrow buttonon the left of the respective field.
  }
  \item{
  To insert the content of your document, copy your article from a website or any other text source and paste it in the \textbf{text field (largest field at the bottom of the pop-up window)}. Single line breaks are automatically removed, while double line breaks (paragraph breaks) are preserved. Some escape sequences and special characters are automatically removed when text is inserted.
  }
  \item{
  If you want to add further meta information to your document, which does not fit the preset categories, you can use the field \textbf{``notes''}.
  }
\end{itemize}
Finally---after checking your specifications---you can import the document to \dna\ by clicking the \textbf{``Add''} button.
\begin{figure}
  \includegraphics[width=\linewidth]{05-2-adddoc}
  \caption{Open \dna-database}
  \label{fig:adddoc}
\end{figure}




\subsection{Importing multiple Documents semi-automatically from text files}\label{subsec:multiimport}
If you want to analyze a greater number of articles, it quickly becomes tedious to manually copy and paste each document and its meta data. This is why \dna\ also offers a semi-automatic way to upload multiple documents and their relevant meta data (author, date, source, type) at the same time.

\paragraph{Downloading and Preparing your Raw Data.}
This way of importing raw data to \dna\ requires that you save all documents as \textbf{separate ``.txt'' files} (one file for each article) \textbf{in a common folder}. Please note, that you have to use the ``.txt'' format for saving your data, as \dna\ can not import ``.doc'' or ``.pdf'' files.\footnote{You can, however, save Word-documents as .txt files or use an online converter to transform PDFs into txt files. Note, that you need to make sure (both cases) that the .txt file is saved with UTF 8 encoding.} In case you use the newspaper database of LexisNexis---which is available through many university lbraries---for finding and retrieving your raw data, please make sure that you download all documents separately (by selecting the individual document before clicking the download button, \textit{see Figure~\ref{fig:nexis}, step 1-2}) and choose the document format ``Text'' (under ``Format Options'' in the Download pop-up menu, \textit{see Figure~\ref{fig:nexis}, step 3-4}) before downloading the data (\textit{see Figure~\ref{fig:nexis}, step 5}).\footnote{If you use \rdna\ it will soon also be possible to import LexisNexis data into \dna\ via using \rdna\ and a new \R package called \href{https://github.com/JBGruber/LexisNexisTools}{LexisNexisTools} \citep{gruber2018}.}
\begin{figure}
  \includegraphics[width=\linewidth]{05-3-nexis}
  \caption{Downloading files from the LexisNexis newspaper archive}
  \label{fig:nexis}
\end{figure}

  If you want to use the preset regex configurations (\hyperref[par:adjregex]{in contrast to adjusting them}) for automatically detecting and uploading the meta data of your documents, you should use a \textbf{file name} in the format \textbf{``DD.MM.YYYY - Author - Source - TYPE.txt''} \textbf{with blanks before and after the minuses}, where ``DD.MM.YYYY'' is the date, on which the article was published. While ``Author'' and ``Source'' do not require a special format or length (e.\,g.\, you can use the first and/or last name of the author), the type of the document must always be indicated by capital letters. For example, the file name of the
article \href{http://spon.de/aeclD}{spon.de/aeclD}, which is used as an example here, would have the format ``31.03.2014 - Ralf Neukirch - SPON International - DIGITALRESOURCE.txt''. Please note, that plain text files are somtimes saved as ``.TXT'' instead of ``.txt'' files. While this is technically the same, it can cause problems while importing multiple text files. If this is the case, you have to either change the preset Regex configuration or correct the ``.txt'' suffix manually in the file name(s). Otherwise the automatic detection of your documents' meta data will not work.

\paragraph{Importing your Raw Data into DNA}
If you prepared your data adequately, you can retrieve the documents and the relevant additional information in four simple steps (\textit{see Figure~\ref{fig:importtxt}}): 

\begin{enumerate}
  \item{
  Click on the index tab \textbf{``Documents''} and select the option \textbf{``Import text files''} (\textit{see Figure~\ref{fig:importtxt}, step 1}). As a result, a new window will open, in which you press the button \textbf{``Select folder''} (\textit{see step 2}). This will open a further pop-up menu. Here, you have to select the \textbf{folder}, in which you saved the text files of your raw data, from the \textbf{``Look in'' slide down menu} (\textit{see step 3}) and click the button \textbf{``Open''} (\textit{see step 4}). 
  }
\begin{figure}
  \includegraphics[width=\linewidth]{05-4-importtxt}
  \caption{Import text files}
  \label{fig:importtxt}
\end{figure}
  
  \item{
  Now all documents, which are stored in the respective folder, should be listed in the main window of the \textbf{``Import text files...''} pop-up (\textit{see Figure~\ref{fig:txtfls}}). If this isn't the case, please check if your documents are saved in the right file format (.txt). In order to check, whether \dna\ is able to automatically identify your documents' meta data, select one of the documents and click on the \textbf{``Refresh''} button (\textit{see Figure~\ref{fig:txtfls}}). If you specified the file names correctly, you can now see the respective meta data of the selected document in the fields ``Title'', ``Author'', ``Source'', ``Type'' and ``Date'' of the \textbf{``Preview''} Section at the bottom right of the ``Import text files'' window (\textit{see Figure~\ref{fig:txtfls}}). 
  }
  \item{
  If you want to adjust or amend the meta data manually, just select the document, \textbf{uncheck} the box \textbf{``Regex''} of the field you want to edit and enter the new or additional information in the field on the left. Then click again on the \textbf{``Refresh''} button to check, whether your changes were accepted. 
  }
  \item{
  Finally, click on the button \textbf{``Import files''} to import all documents of the respective folder into your \dna\ database (you do not need to select each document for import). 
  }
  \begin{figure}
    \includegraphics[width=\linewidth]{05-5-txtfls}
    \caption{Import text files}
    \label{fig:txtfls}
  \end{figure}
\end{enumerate}

\paragraph{Adjusting the Regex Configuration for automatic identification of meta data.}\label{par:adjregex}
The previous steps assumed that you use the preset configuration of \dna\ to detect and upload the meta data (Title, Author, Source, Type, Date) of your documents automatically into your database. However, if you are interested in automatically importing additional information about your source data (in the fields \textbf{``Section''} or \textbf{``Notes''}) or if your file names depart from the naming system layed out here (but nevertheless contain all relevant information in a systematic order), \dna\ allows you to change, adjust or amend the pattern, through which the meta data about your documents is derived from the file names. The commands/rules, on which the ``translation'' of file names into meta data is based, are formulated in the 
\href{https://en.wikipedia.org/wiki/Regular_expression}{Regular expessions (in short: Regex) syntax} and can be edited for each kind of information (Title, Author, Source, Section, Tyoe, Notes, Date) in the field \textbf{``Pattern''} on the bottom left of the ``Import text files...'' window (\textit{see Figure~\ref{fig:txtfls}}). If you want to amend or adjust this settings it is recommended to use a Regex Cheatsheet (\textit{see e.\,g.\, 
\href{https://www.cheatography.com/davechild/cheat-sheets/regular-expressions/}{cheatography.com} 
or 
\href{http://www.txt2re.com/index-perl.php3?s=31.03.2014\%20-\%20Ralf\%20Neukirch\%20-\%20SPON\%20International\%20-\%20DIGITALRESOURCE.txt&-94&-102&80&77&75&81&-95&79&76&78&82&13&14&5&3}{this regex ``translator''}}). As further support, \textit{Figure~\ref{fig:regex}} translates the preset regular expressions of the \dna\ ``Import text files...'' option. 
\begin{figure}
  \includegraphics[width=\linewidth]{05-6-regex}
  \caption{Import text files}
  \label{fig:regex}
\end{figure}

\subsection{Importing Documents from other \dna\ databases}\label{subsec:merge}
You can also import documents from other \dna\ databases. This function is particularly relevant in two scenarios: First, if you not only want to use the \textbf{raw data, but also the coded statements} of an already finished research project, this function allows you to import both. Secondly, if there is \textbf{more than one person working on the same project at the same time} and you did not use multiple user roles (\textit{see Section~\ref{subsec:userman}}) to enable your coders to work on the same remote database. In the second scenario, you should use this function to prepare your datasets or merge the codings, as it is usually difficult to merge the files manually later on. In the latter scenario, the function helps you to avoid trouble with \textbf{duplicate statement IDs} and article names, as \dna\ will take care of e.\,g.\, duplicates automatically. 

Make sure, that you \textbf{know which version of DNA} (DNA 2.0 or older) was used to create and edit the database, from which you want to import data, \textbf{before} using the ``Import from DNA'' function. If you use this manual as a beginner's tutorial for working with \dna\ please download the file ``sample.dna'' from the \dna\ \href{https://github.com/leifeld/dna/releases}{github.com/leifeld/dna/releases}. This file contains a small selection of documents and statements from a larger project about congressional hearings on climate change, employed in the project described in \citet{fisher2013mapping, fisher2013where}.

To import documents (and the included code statements), click on the index tab \textbf{``Documents''} and select the option \textbf{``Import from \dna\ 2.0 file''}, if \dna\ 2.0 was used to create and edit the database. As the internal structure of .dna files has significantly changed since version 1.31, databases created with an older version of \dna\ need to be impored using the seperate method \textbf{``Import from \dna\ 1.31 file''} (\textit{see Figure~\ref{fig:importdna}, step 1}). As a result of either step, a further pop-up menu will open (\textit{see Figure~\ref{fig:importstat}}). In this window, you have to select the \textbf{folder}, in which you saved the text files of your raw data, from the \textbf{``Look in'' slide down menu} (\textit{see step 2}) and \textbf{select the respective .dna file} (\textit{see step 3}). Click the button \textbf{``Open''} (\textit{see step 4}) to then open the menu depicted in \textit{Figure~\ref{fig:importstat}}.
\begin{figure}
  \includegraphics[width=\linewidth]{05-7-importdna}
  \caption{Import a \dna\ 2.0-database}
  \label{fig:importdna}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=0.6\linewidth]{05-8-importstat}
  \caption{Import Statements menu}
  \label{fig:importstat}
\end{figure}

In this menu, you can select, which documents (and respective which coded statements) from the original \dna\ database you want to import in your database by either manually checking or unchecking the boxes on the left of the document title or by using the function \textbf{``Keyword filter''}. This function is particularly helpful if you want to only import few documents with a specific common characteristic (author, topic) from a very large dataset. 
Clicking on the button \textbf{``Keyword filter...''} (\textit{see left button in Figure~\ref{fig:importstat}}) opens a new pop-up window, in which you can enter a specific search term. For example, if you downloaded and opened the \href{https://github.com/leifeld/dna/raw/master/manual/sample.dna}{``sample.dna''} file, you can select all congressional hearings of NGO representatives by \textbf{entering the keyword ``NGO''} in the text field and pressing the button \textbf{``OK''} in the ``Keyword filer'' pop-up window (\textit{see Figure~\ref{fig:importstat}}). Now only the boxes of the three documents, which contain the hearings of NGO representatives Kateri Callahan, David Hamilton and Nayak Navin, should be checked, while the other boxes are unchecked. The ``Keyword filter..'' function is based on the same regex syntax described in \fullref{par:adjregex}. This means, you can also use more specified regular expressions (\textit{see Figure~\ref{fig:regex} or \href{https://www.cheatography.com/davechild/cheat-sheets/regular-expressions/}{regex cheatsheet}}) to select certain articles. For example, if you enter a ``\^{}N'' in the ``Keyword filter'' \dna\ will select all articles starting with a capital N. If you want to undo your selections, you can also automatically select or unselect all articles by pressing the button \textbf{``(Un)select all''} in the middle of the ``Import statements'' window (\textit{see Figure~\ref{fig:importstat}}). Pressing the right button \textbf{``Import selected''} in the same window imports all documents with a checked box (and the respective coded statements) in your \dna\ database (\textit{see Figure~\ref{fig:importstat}}). If you use this manual as a beginner's tutorial for working with \dna, you should try importing all documents and the respective statements from the file \href{https://github.com/leifeld/dna/raw/master/manual/sample.dna}{``sample.dna''} into your database. 

%To DO
%\subsection{Importing Documents using \R\}\label{subsec:importr}




\section{Organizing documents (Raw Data) }
\subsection{Deleting and navigating through documents}
All your imported documents are listed in the upper middle table of the \dna\ main window. If you click on an article, its corresponding text (i. e. the speech) will be displayed in the text area below the document table. By clicking on, for example, the entry ``109-1: Callahan, Kateri-NGO-Y'' you open the speech of Kateri Callahan, a representative of the Alliance to Save Energy. You can adjust the size of the document table (by clicking on the bar above the text area and moving it vertically with your cursor) or its colums (by clicking on the edge of the column and moving it horizontally with your cursor). You can also customize the meta information, which are displayed in the document table: Just \textbf{right click on any document} and use the appearing \textbf{context menu} to (un-)check the boxes of the information you (don't) want to be displayed (\textit{see Figure~\ref{fig:batchrecode}, step 1}). A structured (and customised) overview of your raw data is essential for detecting missing information and thus efficiently controlling, organizing and coding your data. For example, if you display the meta information ``Type'' (by checking the respective box in the context menu), you can see that the type of all documents from the sample.dna file is not listed.
\begin{figure}
  \includegraphics[width=\linewidth]{05-9-batchrecode}
  \caption{Import Statements menu}
  \label{fig:batchrecode}
\end{figure}

The same context menu can be used to delete documents from your database by \textbf{selecting the documents} you want to delete (pressing and holding the \textbf{``Ctrl'' key} for selecting multiple documents), opening the context menu with a \textbf{right click} and choosing the option \textbf{``Delete selected documents''}. 

\subsection{Editing the documents' meta data (author, time etc...)}
DNA allows you to edit, delete or complement the descriptive information related to your raw data (title, date, author, source, section and type of document). Similiar to the procedures outlined in Section~\ref{subsec:importdoc} there is a manual as well as a semi-automatic way to adjust the meta data of your documents.

\paragraph{Editing the documents' meta data manually.}
The most basic way to edit your documents' meta data is to \textbf{select the document}, of which you want to edit the information (by left-clicking on it) and adjusting the values in the \textbf{``Document properties''} submenu on the middle left of the \dna\ main window (\textit{see Figure~\ref{fig:batchrecode}, step 2}) by either manually typing in the relevant information or by selecting an already specified author, a source, a section or a type from the \textbf{drop-down menu} on the right of the respective meta field. For example, in \textit{Figure~\ref{fig:batchrecode} (step 2}) Kateri Callahans speech was selected, and the value ``NGO'' (for Non-Governmental Organisation) was manually specified as ``Type of document'' by entering it in the field ``Type'' of the ``Document properties'' submenu. Do not forget to \textbf{press the button ``Save''} in the submenu (\textit{see Figure~\ref{fig:batchrecode}, step 2}) to confirm your edits. 

Please note, that you can manually only edit the meta data of \textbf{one document at one time}. If you try to select multiple documents for editing, the ``Document properties'' submenu will disappear, returning ``(No document or permission)''.

\paragraph{Editing the documents' meta data semi-automatically.}
However if you want to adjust the meta data of a greater number of articles, it quickly becomes tedious to manually edit information about each document. This is why \dna\ also offers a semi-automatic way to edit, delete or complement the descriptive information related to your documents. In order to edit your documents' meta data semi-automatically, click on the index tab \textbf{``Documents''} and select the option \textbf{``Batch-recode meta-data''} (\textit{see Figure~\ref{fig:batchrecode}, step 3}). As a result, a pop-up window similiar to \textit{Figure~\ref{fig:recodewin}} will open. In the upper half of this pop-up window you find nine fields, which can be configured in order to adjust the meta data for \textbf{multiple documents at once}:
\begin{figure}
  \centering
  \includegraphics[width=0.75\linewidth]{05-10-recodewin}
  \caption{Meta information recode window}
  \label{fig:recodewin}
\end{figure}

\begin{itemize}
  \item{
  The field \textbf{``Target field:''} specifies, which kind of meta information (i.\,e.\, title, author, source, section, type, notes) should be adjusted by choosing the respective meta data category from the slide-down menu (which you open by clicking the arrow on the right of the target field).
  }
  \item{
  The field \textbf{``Source field:''} specifies, where the data you want to use for adjusting the target field is stored. For example, if you simply want to delete or correct (e.\,g.\, misspelt) title-, author-, source-, section-, type- or notes-metadata, you usually choose the same field as source field as you have chosen as target field, since you want to adjust the data already stored in this field. However, if you want to add new data to a (maybe empty or incomplete) target field, you have to choose the part of the meta information as source field, which contains the information, from which you want to derive the new data. As the document title should contain all relevant meta information, ``Title'' is usually used as source field for the latter case.
  }
  \item{
  The field \textbf{``Matching on target regex''} allows you to automatically delimit the documents which you want to adjust, based on the information stored in the document's target field. Similiar to all regex implementations in \dna\ you can either use search terms or regular expressions to filter the documents. If you, for instance, misspelt the author ``Ralf Neukirch'' sometimes as ``Ralf Neu\textbf{n}kirch'', you can correct all your misspellings by simply selecting ``Author'' as ``Target field'', entering ``Ralf Neu\textbf{n}kirch'' in the field ``Matching on target regex:'' and the correct version (``Ralf Neukirch'') in the field ``New target field''. As ``Matching on target regex'' automatically deselects all non-matching cases (here: All documents, who do not have ``Ralf Neunkirch'' specified as their author), the meta information (here: ``Author'') remains the same for all other documents.
  }
  \item{
  The field \textbf{``Matching on source regex''} similarly allows you to automatically filter the documents of which you want to alter the meta data, based on the information stored in the document's source field. For example, if you realise that Ralf Neukirch does not write for ``SPON International'' (as you erroneously specified), but for ``THE GUARDIAN'', you can simply correct all your misspecifications by first selecting ``Source'' as the ``Target field'' and ``Author'' as the ``Source field'', secondly entering ``Ralf Neukirch'' in the field ``Matching on source regex'' and then specifying ``THE GUARDIAN'' as ``New target field''.
  }
  \item{
  The field \textbf{``\%target regular expression''} allows you to specify/match a part of the target field, which you want to use as new information in the same field. For example, if the field ``Author'' somehow contains the full document titles you can reduce the information in the field ``Author'' to just the name of the respective author by entering the regular expression ``\code{(?<=.+?---).+?(?= -)}'' (\textit{see Figure~\ref{fig:regex} or \href{https://www.cheatography.com/davechild/cheat-sheets/regular-expressions/}{regex cheatsheet}}) in the field ``\%target regular expression'' and entering \textbf{``\%target''} in the field ``New target field''. \textbf{Please note, that if you do not use this function, you should not change the preset value ``\code{.+}'' in this field}---because if you do, your recoding might not obtain the expected results.
  }
  \item{
  The field \textbf{``\%target replacement''} defines a new value for the information in the target field---similarly to the fields ``New target field'' and ``\%source replacement''. If you use ``\%target'' as ``New target field'', you have to specify the new, additional, corrected or reduced information in this field.
  }
  \item{
  The field \textbf{``\%source regular expression''} allows you to specify/match a part of the source field, which you want to use as new information in the target field. For example, if your source field is ``Title'' and the titles of your documents have the   recommended format (\textit{i.\,e.\, ``DD.MM.YYYY - Author - Source - TYPE.txt'' with blanks before and after the minuses; see Section~\ref{subsec:multiimport}})  you can automatically specify the meta information for the field ``Author'' by (1.)~choosing ``Author'' as the ``Target field'' and ``Title'' as the ``Source field'', (2.)~entering the regular expression ``\code{(?<=.+?---).+?(?= -)}'' (\textit{see Figure~\ref{fig:regex} or \href{https://www.cheatography.com/davechild/cheat-sheets/regular-expressions/}{regex cheatsheet}}) in the field ``\%source regular expression'' and (3.)~entering \textbf{``\%source''} in the field ``New target field''. \textbf{Please note, that if you do not use this function, you should not change the preset value ``.+'' in this field}---because if you do, your recoding might not obtain the expected results.
  }
  \item{
  The field \textbf{``\%source replacement''}---similarly to the fields ``New target field'' and ``\%target replacement''---defines a new value for the information in the target field. If you use ``\%source'' as ``New target field'', you have to specify the new, additional, corrected or reduced information in this field.
  }
  \item{
  The field \textbf{``New target field''} defines the new, corrected, reduced or additional data, which is entered in your target field (\textit{see examples above}). Please note, that this field has to be set on \textbf{``\%source''} (preset value) if you use the functions ``source regular expression'' or ``source replacement'' and has to be set on \textbf{``\%target''} if you use the functions ``target regular expression'' or ``target replacement''. Otherwise, the respective functions will not work.
  }
\end{itemize}

The lower half of the ``Recode document meta-data'' pop-up window (\textit{see Figure~\ref{fig:recodewin}}) displays a table with four columns and a row for each of your documents, which help you to preview, control and trace back your changes to the meta data:

\begin{itemize}
  \item{
  The column \textbf{``ID''} contains the individual ID of each of your documents. This column can be particularly helpful if you specify a recoding procedures for a certain set of documents. If you know the ID of a few exemplary documents from this set, you can quickly trace back and understand the consequences of your recoding specifications by scrolling down to the respective IDs and taking a look at the other columns of these documents.
  }
  \item{
  The column \textbf{``Source field''} displays the field, from which you get the meta data for recoding the target field. It is particularly helpful to understand the sequence of information in the source field, if you want to specify a ``\%source regular expression'' or use ``Matching on source regex'' (for example, if only some source fields contain the relevant information).
  }
  \item{
  The column \textbf{``Old target field''} shows the meta data in the target fields prior to your adjustments. It is particularly helpful if you want to use ``\%target regular expression'' or use ``Matching on target regex'' (for example, if you only want to change the value of a certain set of target fields).
  }
  \item{
  The column \textbf{``New target field''} displays the consequences of your adjustment. It is particular helpful to check if your recoding will be successful or if some recoding outcomes are actually undesired (for example, if the target field already contained the relevant information, but is recoded nevertheless).
  }
\end{itemize}

Your recodings are only applied, if you press the button \textbf{``Recode''} (on the lower right of the ``Recode document meta data'' window, see Figure~\ref{fig:recodewin}). \textbf{Once this is applied, it cannot be undone!} So please control the consequences of your recodings by using the table at the lower half of the window. However, before pressing the ``Recode'' button, you \textit{can} revert all adjustments by pressing the button \textbf{``Revert changes''} and therefore are able to experiment with the meta data (regex) specifications.

As noted previously, all documents from the file ``sample.dna'' do not specify any meta data concerning the type of the respective document. Both \textbf{Figure~\ref{fig:recodewin}} and \textbf{Figure~\ref{fig:recoderegex}} illustrate an exemplary semi-automatic procedure for complementing this information based on the information stored in the document title (here: The organisation, to which the respective speaker belongs to). Thus in both examples, ``Type'' is selected as ``Target field'', while ``Title'' is selected as ``Source field''.

The example in \textbf{Figure~\ref{fig:recodewin}} uses \textbf{manual search terms} to specify the meta information for the document type. By entering ``NGO'' in the field ``Matching on source regex'' the adjustments are limited to the documents, which contain ``NGO'' in the document title. By entering ``NGO'' in the field ``New target field'', the new value for ``Type'' is specified for the selected documents. As you can see in the table on the lower half of the ``Recode meta-data'' window, this very simple procedure is insofar successful, as only the target fields of documents containing hearings of NGO-representatives are changed and the target fields of all other documents (including those with already correct ``Type'' information) remain unchanged. However, this procedure would have to be repeated for each kind of organisation from the sample (NGO, GOV, BUS).

The more elegant way of semi-automatically specifying meta information is depicted in \textbf{Figure~\ref{fig:recoderegex}}, which uses the \textbf{Regex-syntax}. 
Here, by entering \texttt{\^{}?} in the field ``Matching on target regex'', only those documents are selected for amendment, which do not already contain any information about the document type (therefore excluding those documents with already correct ``Type'' information). 
By specifying \code{(?<=.+?-)[A-Z]+} as ``\%source regular expression'' (and accordingly ``\%source'' as ``New target field''), \dna\ is instructed to filter any string of upper-case characters before a minus in the document title and set it as a new value for ``Type''. Thus you can recode the document type for all documents at once, ensuring that already specified values are not overwritten---as evident from the table in the lower half of the window.
\begin{figure}
  \includegraphics[width=\linewidth]{05-11-recoderegex}
  \caption{Meta information recode window (regex explained)}
  \label{fig:recoderegex}
\end{figure}





%To DO
\FloatBarrier
\chapter{Using \dna : Coding the Data}\label{sec:dna-coding}
\chapterauthor{Johannes Gruber}
Now that you know how to create a database and organise the documents in it, it's time to start with the actual coding. This section describes how to create, edit and navigate through statements as well as how to employ the regex highlighter and search function to make coding of statements easier and faster. If you want to recreate the steps outlined in this section for practice, you should download the file ``sample.dna'' from the \dna\ \href{https://github.com/leifeld/dna/releases}{github.com/leifeld/dna/releases} and open it with the newest version of \dna\ from the same page---if you haven't already done that.

\section{Creating a \dna\ Statement}\label{subsec:createstat}
\FloatBarrier
For the sake of this tutorial, we can create a new coder. You could also select one of the existing coders from the drop-down menu to create statements but it's just nicer if our new statement is associated with our names. Simply click on the plus sign in the coder menu in the upper left corner of the main window (\textit{see Figure~\ref{fig:newuser} , step 1}). In the new menu that opens, enter your name and just leave all permissions selected for now (\textit{see Figure~\ref{fig:newuser} , step 2}). Then you can choose a personal colour. Either you select a predefined one from the swatches tab or you define your own colour using one of the menus in the other tabs (\textit{see Figure~\ref{fig:newuser} , step 3}). After accepting the edit, you can select yourself from the drop-down coder menu. This should always be the first step before you or one of your coders start to work on the database. 
%is there any use for the color?
\begin{figure}
  \includegraphics[width=\linewidth]{06-01-newuser}
  \caption{Create your own personal user for this exercise}
  \label{fig:newuser}
\end{figure}
\begin{figure}
  \includegraphics[width=\linewidth]{06-02-newstatement}
  \caption{Create new \dna\ Statement}
  \label{fig:newstatement}
\end{figure}

To code a new \dna\ Statement, simply select a chunk of text by pressing and holding your left mouse button while sliding over it. When all the text you want to include in the statement is selected, push the right mouse button and select ``Format as \dna\ Statement'' from the appearing drop-down menu (\textit{see Figure~\ref{fig:newuser}}). In the new menu that opens, you need to provide the details for the statement. Every \dna\ Statement consists of 4 pieces of information which you should ideally all provide (Figure~\ref{fig:statdetails}):

\begin{itemize}
  \item{
  \textbf{Person.} The person or actor who speaks or makes the statement. In discourse network analysis it is most often assumed that the organisation, not the person, are the important actors in a policy process. So if you have decided from the start of a project that this is the case, you could leave the person filed empty. However, it might nevertheless be interesting in a later step if there are differences between persons from the same organisation, so it is advised that you complete all fields.
  }
  \item{
  \textbf{Organization.} The organisation the person who makes a statement is affiliated with.
  }
  \item{
  \textbf{Concept.} The concept to which the statement refers. Concepts are usually abstract representations of the topics which are discussed. In advocacy coalition research, for example, concepts are claims for
policy instruments such as ``CO\textsuperscript{2} legislation will not hurt the economy''.
  }
  \item{
  \textbf{Agreement.} A dummy variable (i.\,e.\, a variable with only two possible outcomes) indicating whether the actor agrees with the category or not. Often this is a question of sentiment: if the speaker talks about the concept in a positive way we assume s/he agrees with it. And likewise that s/he disagrees when making a statement in a negative tone. As opposed to the other three fields, it is not possible to \textit{not} provide this information. If you do not tick the box ``agreement'' you indicate disagreement with the selected concept.
  }
\end{itemize}

There are two ways to provide the information: you can either click inside one of the boxes to write in a new category or you can choose a category from the drop-down menu (\textit{see Figure~\ref{fig:statdetails}}). In the first case, \dna\ will try to auto-complete your code by using all existing categories, so you can leave a field incomplete and thereby choose an existing category. In the latter case, the drop-down menu shows all previously coded information, so that it is not necessary to reenter previously coded categories. This is not only convenient but also serves a reliability purpose: multiple similar but not identical categories, created by misspelling or incorrect abbreviation, would lead to spurious results which could jeopardize analysis later on. 

As you can see in Figure~\ref{fig:statdetails}, each statement also has a unique identification number. The ID can't be changed by the user, but it can be used as a primary key if you want to record additional information about your statements in a separate database---e.\,g.\, to automatically merge the information again once you move to analysis in \R\ or other programs. 

There are also two more symbols in the upper right corner of the Statement window: a plus sign, which creates a copy of the current statement.
% what is that for?
And a trash bin symbol, which completly removes your \dna\ Statement, but leaves the document intact (\textit{see Figure~\ref{fig:statdetails}}).

After you are done providing the detail information, you can simply click anywhere outside the menu to return to the main window. The moment you leave the \dna\ Statement window, all your edits are saved in your database---so there is no need to apply the changes or save your progress periodically (\textit{see Figure~\ref{fig:statdetails}}). If you click outside the window by accident, you can return to edit the statement by simply clicking on it again (\textit{more in the next section}). After you return to the main page, the statement is now highlighted in yellow (\textit{see Figure~\ref{fig:stathl}}). All \dna\ Statements have the colour which was selected when the \dna\ database was created. The only way to change the highlight colour would be to create a new database.
\begin{figure}
  \includegraphics[width=\linewidth]{06-03-statdetails}
  \caption{Create new \dna\ Statement}
  \label{fig:statdetails}
\end{figure}
\begin{figure}
  \includegraphics[width=\linewidth]{06-04-stathl}
  \caption{\dna\ Statements are highlighted in yellow, annotations in grey by default}
  \label{fig:stathl}
\end{figure}

Besides \dna\ Statements, you can also create annotations. In the sample database, annotations are highlighted in grey.
%reason for annotations?


\FloatBarrier
\section{Navigating through statements}
For this subsection, we focus our attention on the \textbf{``Statements''} window on the upper right corner of the main menu. This window is presented as a table with an ``ID'' column and a ``Text'' column in which the text underlying a \dna\ Statement is displayed (\textit{see Figure~\ref{fig:statements}}). 

There are three ways to navigate through statements. The first is displayed if you select the option \textbf{``all''} below the list of statements. As the name suggests, the window shows all statements, ordered by appearance in your database. The statements in the first document are on top, the statements in the last document you added are at the bottom of the table. By clicking on a statement you jump to the document and position it appears.

The second option is called \textbf{``current''}. It provides a filter, so only the statements in the currently selected document are displayed in the Statements table. If you navigate to a different document, this selection will change. On top of the table, you should see the new statement you just created. If you haven't added or removed a statement before, the ID of the statement should be ``42''.

The third option is called \textbf{``filter''}. When you choose this option, the ``Statements'' box increases in size and shows five new fields in which you can provide keywords to filter by for different fields in the \dna\ Statement: ID, person, organization, concept, agreement and a drop-down menu where you an switch between statement types. By entering, for instance, ``There should be legislation to regulate emissions.'' in the concept field, only statements regarding that concept will be displayed. Again, it is not necessary to provide the full text but it is sufficient to write in enough characters to differentiate the code clearly from other ones in the database. For example, if there would be a different concept called ``There should be legislation for cap and trade.'', then you would have to enter at least ``There should be legislation \textbf{t}'' before \dna\ can differentiate the two concepts. Or even easier, you could simply enter ``emissions'' to display only statements for which the concept contains the word ``emissions''. Additionally, you can again use regular expressions in the filter fields (\textit{see Section~\ref{par:adjregex}}). For instance, if you type ``1[2-5]'' into the ID field, \dna\ will display all statements between 12 and 15.

Instead of searching statements by just one variable, you can also combine filters. By entering ``There should be legislation to regulate emissions.'' in the concept field and ``Bob'' in the person field, only the \dna\ Statements regarding this specific concept and were made by Bob Slaughter---who is the only Bob in the database---are displayed.

The filter fields all work in this way except \textbf{``agreement''} which only takes the values 0 for disagreement and 1 for agreement.
\begin{figure}
  \includegraphics[width=\linewidth]{06-05-statements}
  \caption{Statements window in detail}
  \label{fig:statements}
\end{figure}


\section{Editing a statements}
\FloatBarrier
To edit a statement's details, you first need to select it, either by choosing it from the Statements table (\textit{see Figure~\ref{fig:statements}}) or directly in the text. This will open the same window as in Figure~\ref{fig:statdetails} which we discussed in detail in Section~\ref{subsec:createstat}.

Besides that, you can also provide additional information for the variables in the \dna\ Statements. To find this menu you first have toggle the option to display a new window beneath the text window. To do that, find the view options in the top right corner of the main window (\textit{see Figure~\ref{fig:editdetails}, step 1}). The three options you see here control how \dna\ looks or, more precisely, which menus are displayed. The left option displays/hides the ``Coder'' and ``Document properties'' menus, while the right one displays/hides the ``Statements'', ``Search within document'' and ``Regex highlighter'' menus. However, now we need the middle option which displays the mentioned field beneath the document text. 
\begin{figure}
  \includegraphics[width=\linewidth]{06-06-editdetails}
  \caption{Statements window in detail}
  \label{fig:editdetails}
\end{figure}

In this window, you can make edits to persons, organizations or concepts in all \dna\ Statements at once, rather than to single statements. The advantage is that you do not have to edit each individual statement if you notice that you misspelt a name, that two concepts which you have coded actually represent the same idea or if you simply find a better concept name which adds some clarity. When you edit a concept (or person or organisation) in this menu, it is changed in all \dna\ Statements at once. When this menu is first opened, it contains no information before you select either ``\dna\ Statement'' or ``Annotation'' from the left drop-down menu (\textit{see Figure~\ref{fig:editstatm}}).
\begin{figure}
  \centering
  \includegraphics[width=0.6\linewidth]{06-07-editstatm}
  \caption{Recode a whole concept label instead of individual statement}
  \label{fig:editstatm}
\end{figure}

To provide additional information for persons, organizations or concepts you have to click on the label symbol in the top right corner of the same window (\textit{see Figure~\ref{fig:editdetails}, step 2}). As in the other menu, the window contains no entries before you select if you want to edit statements or annotations from the left drop-down list (\textit{see Figure~\ref{fig:editdetails}, step 3}). In the table presented now, you can add colour, type, alias and notes for each person, organization or concept. This information is not directly used in \dna\ but, as we will see in Section~\ref{sec:rdna}, can be used during analysis with \rdna.

\FloatBarrier
\section{Using the Regex highlighter and search function}
The last part of this section about coding statements in \dna\ describes how you can use the ``Regex highlighter'' and ``Search within document'' functions to help you quickly identify relevant parts of the documents you will be coding. Both functions are located on the right panel of the main window and can be folded or unfolded like every window in \dna\  (\textit{see Figure~\ref{fig:search}}).

We begin with the \textbf{``Search within document''} menu as it is what most people are already familiar with. By entering a search term in the text field, you can jump between all occurrences of that keyword in the current document in the same way as it works in popular text processing programs (such as MS Word) or in your web browser. You can test this by entering the term ``greenhouse effect'' and browse through the occurrences in Navin Nayak's hearing in the U.S. Congress (that is the second to last document in the database) with the left and right arrow buttons. As you might notice, all mentions of the greenhouse effect are fairly close together and Coder 1 has formatted a large part the section they are mentioned as \dna\ Statement. This is what will often happen during coding: as authors of a text or speakers will order their document or speech around sub-topics, the statements you wish to code can be close together. If you already know the most important keywords, it might therefore not be necessary to closely read the whole article or speech but can be more fruitful and efficient to jump between potential statements and only skim the remaining lines.

One feature which sets the search function in \dna\ apart from other programs with which you are already familiar is again that it can take Regex expressions. One useful feature of Regex commands in this scenario is that you can use multiple keywords at the same time by putting the vertical bar character \textbf{``|''}, which represents the \textit{OR}, operator between them. You find this character next to the Shift button on your keyboard. So for instance, you could write ``global warming\textbf{|}climate change" to browse through all mentions of either of those words in the current document. Combining multiple keywords can serve as a quick way to browse through documents which are yet to code or which have already been coded to identify the most relevant parts.

The \textbf{``Regex highlighter''} works in much the same way. But instead of browsing through the occurrences of a key term, you can change its font colour to a colour of your choice. Looking again at \textit{Figure~\ref{fig:search}}, you can see that multiple words have a different font colour: ``dioxide'' is orange, ``greenhouse'' is green, ``clima'' is blue and so on. This can help coders to notice when theory induced keywords appear in a paragraph. Again, it can be of help if you know a few basics about regular expressions, but as you can see, most of the keywords are written in plain English and you can use that as well if you prefer. However, consider that instead of the regular expression C[Oo0]2 you would have to enter both ``CO2'' and ``C02''. The Regex highlighter, just as the search function, is by default case insensitive. If you wish to highlight only specific cases of a word, you can put the option ``(?-i)'' at the beginning of your search string.

\begin{figure}
  \includegraphics[width=\linewidth]{06-08-search}
  \caption{The Search and regex highlighter functions}
  \label{fig:search}
\end{figure}
This concludes the section about how to code statements in \dna. Even though this chapter turned out to be shorter than the two previous ones, this is where you will spend most time while using \dna. Coding the statements is what requires most manual work and in the future, it is hopefully possible to include some machine learning features into the software so semiautomatic statement recognition can reduce the amount of necessary manual coding efforts. Yet, so far, this is an active research frontier and it will probably take a few more years before techniques are accurate  to augment human coding.


%To DO
\chapter{Using \dna : Exporting the coded Data}\label{sec:dna-export}
\FloatBarrier
\textit{Coming soon...}





\chapter{\rdna: Using \dna\ from \R} \label{sec:rdna}
\chapterauthor{Philip Leifeld}
\FloatBarrier
\dna\ can be connected to the statistical computing environment \R\ \citep{coreteam2014r:} through the \rdna\ package \citep{leifeld2018rdna}.
There are two advantages to working with \R\ on \dna\ data.

The first advantage is replicability.
The network export function of \dna\ has many options.
Remembering what options were used in an analysis can be difficult.
If the analysis is executed in \R, commands---rather than mouse clicks---are used to extract networks or attributes from \dna.
These commands are saved in an \R\ script file.
This increases replicability because the script can be re-used many times.
For example, after discovering a wrong code somewhere in the \dna\ database, it is sufficient to fix this problem in the \dna\ file and then re-run the \R\ script instead of manually setting all the options again.
This reduces the probability of making errors and increases replicability.

The second advantage is the immense flexibility of \R\ in terms of statistical modelling.
Analysing \dna\ data in \R\ permits many forms of data analysis beyond simple visualization of the resulting networks.
Examples include cluster analysis or community detection, scaling and application of data reduction techniques, centrality analysis, and even statistical modelling of network data.
\R\ is also flexible in terms of combining and matching the data from \dna\ with other data sources.

\section{Getting started with \rdna}
The first step is to install \R.
Installing additional \R\ packages for network analysis and clustering, such as \texttt{statnet} \citep{goodreau2008statnet, handcock2008statnet, handcock2016statnet}, \texttt{xergm} \citep{leifeld2017temporal, leifeld2017xergm:}, \texttt{igraph} \citep{csardi2006igraph}, and \texttt{cluster} \citep{maechler2017cluster}, is recommended.
Moreover, it is necessary to install the \texttt{rJava} package \citep{urbanek2016rjava}, on which the \rdna\ package depends, and the \texttt{devtools} package \citep{wickham2016devtools}, which permits installing \R\ packages from GitHub (\textit{see Section~\ref{subsection:installdna}}).

<<eval=FALSE>>=
install.packages("statnet")
install.packages("xergm")
install.packages("igraph")
install.packages("cluster")
install.packages("rJava")
install.packages("devtools")
@

After installing these supplementary packages, the \rdna\ package can be installed from \github.
The \texttt{devtools} package contains a function that permits easy installation of \R\ packages from GitHub and can be used as follows to install \rdna:

<<eval=FALSE>>=
library("devtools")
install_github("leifeld/dna/rDNA")
@

Once installed, the \rdna\ package must be attached to the workspace:

<<eval=TRUE, results = 'tex', message = FALSE>>=
library("rDNA")
@

To ensure that the following results can be reproduced exactly, we should set the random seed in \R:

<<eval=TRUE, results = 'tex', message = FALSE>>=
set.seed(12345)
@

Now we are able to use the package. The first step is to initialize \dna.
Out of the box, \rdna\ does not know where the \dna\ \texttt{.jar} file is located.
We need to register \dna\ with \rdna\ to use them together.
To do that, one needs to save the \dna\ \texttt{.jar} file to the working directory of the current \R\ session and then initialize \dna\ as follows (with \texttt{dna-2.0-beta20.jar} in this example):

<<eval=TRUE, results = 'tex', message = FALSE>>=
dna_init("dna-2.0-beta20.jar")
@

After initializing \dna, we can open the \dna\ graphical user interface from the \R\ command line:

<<eval=FALSE>>=
dna_gui()
@

Alternatively, we can provide the file name of a local \dna\ database as an argument, and the database will be opened in \dna.
For example, we could open the \texttt{sample.dna} database that is provided for download on \github\ under \texttt{Releases}:

<<eval=FALSE>>=
dna_gui("sample.dna")
@

For this to work, the database file has to be saved in the working directory of the \R\ session, or the path needs to be provided along with the file name.

In addition to opening the GUI, we will want to retrieve networks and attributes from \dna.
For this to happen, a connection with a \dna\ database must first be established using the \code{dna\_connection} function:

<<eval=TRUE>>=
conn <- dna_connection("sample.dna")
@

The \code{dna\_connection} function accepts a file name of the database including full or relative path (or, alternatively, a connection string to a remote \texttt{MySQL} database) and optionally the login and password for the database (in case a remote \texttt{MySQL} database is used).
Details about the connection can be printed by calling the resulting object called \texttt{conn}.

After initializing \dna\ and establishing a connection to a database, we can now retrieve data from \dna.
We will start with a simple example of a two-mode network from the sample database.
To compute the network matrix, the connection that we just established must be supplied to the \code{dna\_network} function:

<<eval=TRUE, results = 'tex'>>=
nw <- dna_network(conn)
@

The resulting matrix can be plotted using visualization functions from the \texttt{statnet} suite of packages:

<<eval=TRUE, message = FALSE, warning = FALSE, results = 'tex', fig.width = 4, fig.height = 4, crop = TRUE>>=
library("statnet")
gplot(nw)
@

It is also easily possible to retrieve the attributes of a variable, for example the colours and types of organizations, using the \code{dna\_attributes} function:

<<eval=TRUE, results = 'tex'>>=
at <- dna_attributes(conn)
@

The result is a data frame with organizations in the rows and one column per organizational attribute.
The next section will provide usage examples of both the \code{dna\_network} and the \code{dna\_attributes} functions.


\section{Retrieving networks and attributes}
This section will explore the \code{dna\_network} function and facilities for retrieving attributes in more detail.
The \code{dna\_network} function has a number of arguments, which resemble the export options in the \dna\ export window.
The help page for the \code{dna\_network} function provides details on these arguments.
It can be opened using the command

<<eval=FALSE>>=
help("dna_network")
@

We will start with a simple example: a one-mode congruence network of organizations in a policy debate.
The \texttt{sample.dna} database is a small excerpt from a larger empirical research project that tries to map the ideological debates around American climate politics in the U.S. Congress over time.
Details about the dataset from which this excerpt is taken are provided by \citet{fisher2013mapping, fisher2013where}.
Here, it suffices to say that the \texttt{sample.dna} file contains speeches from hearings in the U.S.\ Congress in which interest groups and legislators make statements about their views on climate politics. 
Accordingly, one should expect to find a polarized debate with environmental groups on one side and industrial interest groups on the other side.
To compute a one-mode congruence network, the following code can be used:

<<eval=TRUE, results = 'tex'>>=
congruence <- dna_network(conn, 
                          networkType = "onemode", 
                          statementType = "DNA Statement", 
                          variable1 = "organization", 
                          variable2 = "concept", 
                          qualifier = "agreement", 
                          qualifierAggregation = "congruence", 
                          duplicates = "document")
@

The result is an organization $\times$ organization matrix, where the cells represent on how many concepts any two actors (i\,e., the row organization and the column organization) had the same issue stance (by values of the qualifier variable \code{agreement}).

The arguments of the \code{dna\_network} function resemble the options in the \dna\ export window.
Details on the various arguments of the function can be obtained by displaying the help page (\code{?dna\_network}). In the code chunk above, \code{statementType = "DNA Statement"} indicates which statement type should be used for the network export.
In this case, the statement type \texttt{\dna\ Statement} contains the variables \code{organization}, \code{concept}, and \code{agreement}.
The argument \code{qualifierAggregation = "congruence"} causes \rdna\ to count how often the unique elements of \code{variable1} have an identical value on the \code{qualifier} variable (here: \code{agreement}) when they refer to a concept (\code{variable2}).

If the algorithm finds duplicate statements within documents---i.\,e., statements containing the same organization, concept, and agreement pattern---, only one of them is retained for the analysis (\code{duplicates = "document"}).

The resulting matrix can be converted to a network object and plotted as follows:

<<eval=TRUE, message = FALSE, warning = FALSE, results = 'tex', fig.width = 8, fig.height = 5, crop = TRUE>>=
nw <- network(congruence)
plot(nw, 
     edge.lwd = congruence^2, 
     displaylabels = TRUE, 
     label.cex = 0.5, 
     usearrows = FALSE, 
     edge.col = "gray"
     )
@

Here, we used the \code{edge.lwd} argument of the \code{plot.network} function to make the line width proportional to the strength of congruence between actors.
We used squared edge weights to emphasize the difference between low and high edge weights.
We also displayed the labels of the nodes at half the normal size, suppressed arrow heads, and changed the colour of the edges to grey.
More information about the visualization capabilities of the \texttt{network} and \texttt{sna} packages are provided by \citet{butts2008social, butts2008network, butts2015network}.

The network is not particularly polarized.
We can suspect that some of the concepts are not very contested.
If they are supported by all actors, this may mask the extent of polarization with regard to the other concepts.We can see if this is the case by plotting the agreement and disagreement towards concepts with \code{dna\_plotCentrality}:

<<eval=TRUE, message = FALSE, warning = FALSE, results = 'tex', fig.width = 10, fig.height = 5, crop = TRUE>>=
dna_plotCentrality(conn,
                   of = "concept",
                   fontSize = 9,
                   truncate = 50)
@
It looks like the the concept ``There should be legislation to regulate emissions.'' is in fact very consensual. By repeating the same command with a few different options we can check if the organizations do in fact all agree on this matter:
<<eval=TRUE, message = FALSE, warning = FALSE, results = 'tex', fig.width = 10, fig.height = 5, crop = TRUE>>=
dna_plotCentrality(conn,
                   of = "organization",
                   fontSize = 9,
                   truncate = 50,
                   excludeValues = list("concept" = 
                        "There should be legislation to regulate emissions."),
                   invertValues = TRUE)
@
Instead of plotting agreement towards the concept, \code{of = "organization"} shows how often organizations agreed or disagreed with any statements. Yet, by combining \code{excludeValues} and \code{invertValues = TRUE}, we tell \R\ to \textit{only} regard the statement we want to look at.
The plot shows that everyone but the ``National Petrochemical \& Refiners Association'' agrees to the concept we chose, which indicates that consnesus on the statement ``There should be legislation to regulate emissions.'' obfuscates the real structure of the network.
Therefore we should exclude it from the congruence network.
To do that, we need to export and plot the congruence network again and use the \code{excludeValues} argument this time:

<<eval=TRUE, message = FALSE, warning = FALSE, results = 'tex', fig.width = 8, fig.height = 5, crop = TRUE>>=
congruence <- 
  dna_network(conn,
              networkType = "onemode", 
              statementType = "DNA Statement", 
              variable1 = "organization", 
              variable2 = "concept", 
              qualifier = "agreement", 
              qualifierAggregation = "congruence", 
              duplicates = "document", 
              excludeValues = list("concept" = 
                  "There should be legislation to regulate emissions."))
nw <- network(congruence)
plot(nw, 
     edge.lwd = congruence^2, 
     displaylabels = TRUE, 
     label.cex = 0.5, 
     usearrows = FALSE, 
     edge.col = "gray"
     )
@

This reveals the structure of the actor congruence network.
There are two camps revolving around environmental groups on the right and industrial interest groups and state actors on the left, with \texttt{Energy and Environmental Analysis, Inc.} taking a bridging position.
The strongest belief congruence ties can be found within, rather than between, the coalitions.

Next, we should tweak the congruence network further by changing the appearance of the nodes.
We can use the colours for the organization types saved in the database and apply them to the nodes in the network.
We can also make the size of each node proportional to its activity.
The \code{dna\_attributes} function serves to retrieve these additional data from \dna.
The result is a data frame with the relevant data for each organization in the \texttt{colour} and \texttt{frequency} columns:

<<eval=TRUE, results = 'show'>>=
at <- dna_attributes(conn, 
                     statementType = "DNA Statement", 
                     variable = "organization")
at
@

To use these data in the congruence network visualization, we can use the plotting facilities of the \code{plot.network} function:

<<eval=TRUE, message = FALSE, warning = FALSE, results = 'tex', fig.width = 8, fig.height = 5, crop = TRUE>>=
plot(nw, 
     edge.lwd = congruence^2, 
     displaylabels = TRUE, 
     label.cex = 0.5, 
     usearrows = FALSE, 
     edge.col = "gray", 
     vertex.col = at$color, 
     vertex.cex = at$frequency
     )
@

This yields a clear visualization of the actor congruence network, with simultaneous display of the network structure including its coalitions, the actors' activity in the debate, and actor types.

Another way to visualize a discourse network is a two-mode network visualization.
To compute a two-mode network of organizations and concepts, the following code can be used:

<<eval=TRUE, results = 'tex'>>=
affil <- dna_network(conn, 
                     networkType = "twomode", 
                     statementType = "DNA Statement", 
                     variable1 = "organization", 
                     variable2 = "concept", 
                     qualifier = "agreement", 
                     qualifierAggregation = "combine", 
                     duplicates = "document",
                     verbose = FALSE)
@

This creates a $7 \times 6$ matrix of organizations and their relations to concepts. 
The argument \code{networkType = "twomode"} is necessary because the rows and columns of the \texttt{affil} matrix should contain different variables.
The arguments \code{variable1 = "organization"} and \code{variable2 = "concept"} define which variables should be used for the rows and columns, respectively.
The arguments \code{qualifier = "agreement"} and \code{qualifierAggregation = "combine"} define how the cells of the matrix should be populated:
\code{agreement} is a binary variable, and the \code{combine} option causes a cell to have a value of $0$ if the organization never refers to the concept, $1$ if the organization refers to the respective concept exclusively in a positive way, $2$ if the organization refers to the concept exclusively in a negative way, and $3$ if there are both positive and negative statements by the organization about the concept.
\rdna\ reports on the \R\ console what each combination means.

As in the previous example, the resulting network matrix can be converted to a \texttt{network} object (as defined in the \texttt{network} package).
The colours of the edges can be stored as an edge attribute, and the resulting object can be plotted with different colours representing positive, negative, and ambivalent mentions.

<<eval=TRUE, message = FALSE, warning = FALSE, results = 'tex', fig.width = 8, fig.height = 5, crop = TRUE>>=
nw <- network(affil, bipartite = TRUE)
colors <- as.character(t(affil))
colors[colors == "3"] <- "blue"
colors[colors == "2"] <- "red"
colors[colors == "1"] <- "green"
colors <- colors[colors != "0"]
set.edge.attribute(nw, "color", colors)
plot(nw, 
     edge.col = get.edge.attribute(nw, "color"), 
     vertex.col = c(rep("white", nrow(affil)), 
                    rep("black", ncol(affil))), 
     displaylabels = TRUE, 
     label.cex = 0.5
     )
@

In this example, we first converted the two-mode matrix to a bipartite \texttt{network} object, then created a vector of colours for the edges (excluding zeros), and inserted this vector into the \texttt{network} object as an edge attribute.
It was necessary to work with the transposed \texttt{affil} matrix (using the \code{t} function) because the \code{set.edge.attribute} function expects edge attributes in a row-wise order while the \code{as.character} function returns them in a column-wise order based on the \texttt{affil} matrix.
Finally, we plotted the network object with edge colours and labels.
In the visualization, we used white nodes for organizations and black nodes for concepts.

We can now see the opinions of all actors on the various concepts.
The blue edge indicates that \texttt{Energy and Environmental Analysis, Inc.} has both positive and negative things to say about the concept \texttt{``Emissions legislation should regulate CO2''}.
This is why this organization acts as a bridge between the two camps in the congruence network.
Furthermore, we can now see more clearly that the concept we omitted in the congruence network, \texttt{``There should be legislation to regulate emissions''}, is viewed positively by four organizations, but still receives a negative mention by one actor.
The green edges span both camps, and this caused additional connections between the two groups.
The negative tie is ignored in the construction of the congruence network because conflicts are not counted and there is no second red tie to that concept.

% \section{Cluster analysis}
% TODO

% \section{Heat maps}
% TODO

% \section{Multi-dimensional scaling}
% TODO

% \section{Correspondence analysis}
% TODO

\bibliographystyle{apalike}
\bibliography{dna-manual}

\end{document}